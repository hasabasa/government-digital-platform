# ğŸ”§ Cube Demper â€” Backend

ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ½Ğ° Node.js + TypeScript Ğ´Ğ»Ñ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñ‹ **Cube Demper**.

## ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     API Gateway (8080)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Auth Service â”‚ User Service â”‚ Chat Service â”‚ Finance Service â”‚
â”‚    (3001)    â”‚    (3002)    â”‚    (3003)    â”‚     (3005)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   PostgreSQL â”‚   Redis   â”‚ ElasticSearch â”‚ MinIO â”‚ RabbitMQ â”‚
â”‚    (5432)    â”‚  (6379)   â”‚    (9200)     â”‚ (9000)â”‚  (5672)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚

### Ğ¢Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- Docker Ğ¸ Docker Compose
- Node.js 18+

### Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°

```bash
# 1. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹
npm install

# 2. Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¸Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹
docker-compose up -d

# 3. Seed Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ (4 Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°)
npx tsx apps/auth-service/scripts/seed-users.ts
```

### Ğ”ĞµĞ¼Ğ¾-Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ñ‹

| Ğ˜Ğ¼Ñ | Email | ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ | Ğ Ğ¾Ğ»ÑŒ |
|-----|-------|--------|------|
| Ğ¥Ğ°ÑĞµĞ½Ñ…Ğ°Ğ½ ĞšĞ°Ğ·Ğ¸Ğ¼Ğ¾Ğ² | hasen@cube.kz | hasen123 | admin |
| ĞĞ´Ğ¸Ğ»ÑŒ Ğ¥Ğ°Ğ¼Ğ¸Ñ‚Ğ¾Ğ² | adil@cube.kz | adil123 | admin |
| ĞĞ·Ğ°Ğ¼Ğ°Ñ‚ Ğ‘ĞµĞºÑ…Ğ°Ğ»Ğ¸ĞµĞ² | azamat@cube.kz | azamat123 | admin |
| ĞĞ»Ğ¿Ğ°Ğ¼Ñ‹Ñ ĞœĞ°Ò›Ğ°Ğ¶Ğ°Ğ½ | alpamys@cube.kz | alpamys123 | employee |

## ğŸ“Š Ğ¡ĞµÑ€Ğ²Ğ¸ÑÑ‹

### Auth Service (3001)
- Email/Password Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ (bcrypt)
- ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· Ğ­Ğ¦ĞŸ (legacy)
- JWT Ñ‚Ğ¾ĞºĞµĞ½Ñ‹ (Access 15 Ğ¼Ğ¸Ğ½ + Refresh 7 Ğ´Ğ½ĞµĞ¹)
- Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞµÑÑĞ¸ÑĞ¼Ğ¸ Ğ² Redis
- Rate limiting

### User Service (3002)
- Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑĞ¼Ğ¸
- Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ¾Ğ²
- Ğ Ğ¾Ğ»Ğ¸: `admin`, `manager`, `employee`
- ĞŸĞ¾Ğ¸ÑĞº Ñ‡ĞµÑ€ĞµĞ· Elasticsearch

### Chat Service (3003)
- Real-time Ñ‡Ğ°Ñ‚Ñ‹ Ñ‡ĞµÑ€ĞµĞ· WebSocket
- Ğ›Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ¸ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ¾Ğ²Ñ‹Ğµ Ñ‡Ğ°Ñ‚Ñ‹
- E2E ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (AES-256-GCM)
- Typing indicators

### Finance Service (3005)
- Ğ£Ñ‡Ñ‘Ñ‚ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶ Ğ¸ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¹
- ĞšĞ°ÑÑĞ° (POS)
- Ğ Ğ°ÑÑ‡Ñ‘Ñ‚ Ğ´Ğ¾Ğ»ĞµĞ¹ Ğ°ĞºÑ†Ğ¸Ğ¾Ğ½ĞµÑ€Ğ¾Ğ²
- Ğ¤Ğ¸Ğ½Ğ°Ğ½ÑĞ¾Ğ²Ñ‹Ğµ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ñ‹

## ğŸ” ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ

### API Ğ­Ğ½Ğ´Ğ¿Ğ¾Ğ¸Ğ½Ñ‚Ñ‹

```http
POST /api/v1/auth/register         # Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ (email + Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ)
POST /api/v1/auth/login-email      # Ğ’Ñ…Ğ¾Ğ´ Ğ¿Ğ¾ email
POST /api/v1/auth/login            # Ğ’Ñ…Ğ¾Ğ´ Ñ‡ĞµÑ€ĞµĞ· Ğ­Ğ¦ĞŸ
POST /api/v1/auth/refresh          # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¾ĞºĞµĞ½Ğ°
POST /api/v1/auth/logout           # Ğ’Ñ‹Ñ…Ğ¾Ğ´
GET  /api/v1/auth/me               # Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ
```

### RBAC (Ğ Ğ¾Ğ»Ğ¸)

| Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ | Admin | Manager | Employee |
|---------|:-----:|:-------:|:--------:|
| Ğ”Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ | âœ… | âœ… | âœ… |
| Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸ | âœ… | âœ… | âœ… |
| Ğ§Ğ°Ñ‚ | âœ… | âœ… | âœ… |
| ĞšĞ°ÑÑĞ° | âœ… | âœ… | âŒ |
| Ğ¤Ğ¸Ğ½Ğ°Ğ½ÑÑ‹ | âœ… | âœ… | âŒ |

## ğŸ’¾ Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

- **ORM**: Drizzle ORM
- **ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸**: drizzle-kit
- **Ğ¡Ñ…ĞµĞ¼Ñ‹**: `packages/database/src/schema/`

### ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹
- `users` â€” Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ (Ñ passwordHash)
- `sessions` â€” JWT-ÑĞµÑÑĞ¸Ğ¸
- `tasks` / `task_assignments` â€” Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ñ completionNote
- `organizations` â€” Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
- `chats` / `messages` â€” Ñ‡Ğ°Ñ‚Ñ‹ Ğ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
- `sales` / `sale_items` â€” Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸
- `shareholder_distributions` â€” Ğ´Ğ¾Ğ»Ğ¸ Ğ°ĞºÑ†Ğ¸Ğ¾Ğ½ĞµÑ€Ğ¾Ğ²

## ğŸ“¦ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°

```
backend/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ auth-service/          # ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
â”‚   â”‚   â””â”€â”€ scripts/seed-users.ts
â”‚   â”œâ”€â”€ user-service/          # ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸
â”‚   â”œâ”€â”€ chat-service/          # Ğ§Ğ°Ñ‚Ñ‹
â”‚   â”œâ”€â”€ finance-service/       # Ğ¤Ğ¸Ğ½Ğ°Ğ½ÑÑ‹
â”‚   â””â”€â”€ api-gateway/           # Gateway
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ types/                 # ĞĞ±Ñ‰Ğ¸Ğµ Ñ‚Ğ¸Ğ¿Ñ‹
â”‚   â””â”€â”€ database/              # Drizzle ÑÑ…ĞµĞ¼Ñ‹
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ package.json
```

## ğŸ”§ Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°

```bash
# Dev-Ñ€ĞµĞ¶Ğ¸Ğ¼ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ñ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
npm run dev --workspace=apps/auth-service
npm run dev --workspace=apps/finance-service

# Ğ¡Ğ±Ğ¾Ñ€ĞºĞ°
npm run build

# Docker
docker-compose up -d          # Ğ—Ğ°Ğ¿ÑƒÑĞº
docker-compose down           # ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°
docker-compose logs -f        # Ğ›Ğ¾Ğ³Ğ¸
```

## ğŸ›¡ï¸ Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

- **ĞŸĞ°Ñ€Ğ¾Ğ»Ğ¸**: bcrypt (salt rounds: 12)
- **JWT**: RS256, access 15 Ğ¼Ğ¸Ğ½ / refresh 7 Ğ´Ğ½ĞµĞ¹
- **Sessions**: Redis Ñ TTL
- **Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ**: E2E Ğ´Ğ»Ñ Ñ‡Ğ°Ñ‚Ğ¾Ğ² (AES-256-GCM)
- **Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ**: Zod Ğ½Ğ° Ğ²ÑĞµÑ… endpoints
- **Rate Limiting**: per-IP + per-user

---

**Cube Demper** â€” Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¾Ğ¹, Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ°Ğ¼Ğ¸ Ğ¸ Ñ„Ğ¸Ğ½Ğ°Ğ½ÑĞ°Ğ¼Ğ¸.
