
ДОРАБОТКА ГОТОВОГО ПРОЕКТА "Соцсеть для госслужащих Казахстана"

====================================
0. ОБЩИЕ ПРАВИЛА
====================================
- Проект уже реализован, бэкенд и фронтенд готовы.
- НЕ переписывать с нуля.
- НЕ изменять:
    * систему авторизации (ЭЦП, JWT, роли)
    * текущую цветовую схему и стили
    * существующие рабочие модули
- Все новые функции интегрировать максимально безболезненно в текущую архитектуру.

====================================
1. ОПИСАНИЕ ТЕКУЩЕГО ФРОНТЕНДА
====================================
==============================================================================
                    ОПИСАНИЕ ФРОНТЕНДА ПЛАТФОРМЫ ГОССЛУЖАЩИХ
==============================================================================

ОБЩАЯ АРХИТЕКТУРА:
├── React 18 + TypeScript PWA приложение
├── Telegram-подобный дизайн интерфейса
├── TailwindCSS + кастомная цветовая схема
├── Адаптивный дизайн (мобильные + десктоп)
├── Темная и светлая темы
├── WebSocket для real-time коммуникации
├── Zustand для управления состоянием
├── Vite как build tool и dev server
└── PWA с offline поддержкой

==============================================================================
                               ТЕХНОЛОГИЧЕСКИЙ СТЕК
==============================================================================

ОСНОВНЫЕ ТЕХНОЛОГИИ:
├── React 18.2 (Composition API, hooks)
├── TypeScript 5.2 (строгая типизация)
├── Vite 5.0 (build tool, dev server)
├── TailwindCSS 3.3 (utility-first CSS)
├── React Router DOM 6.20 (маршрутизация)
├── Socket.IO Client 4.7 (WebSocket)
├── Zustand 4.4 (state management)
├── React Query 3.39 (API state management)
├── Axios 1.6 (HTTP клиент)
└── Framer Motion 10.16 (анимации)

UI И UX БИБЛИОТЕКИ:
├── Lucide React 0.294 (иконки)
├── React Hot Toast 2.4 (уведомления)
├── React Hook Form 7.48 (формы)
├── React Intersection Observer 9.5 (lazy loading)
├── React Window 1.8 (виртуализация списков)
├── React Virtualized Auto Sizer 1.0 (автоматический размер)
├── Date-fns 2.30 (работа с датами)
├── Clsx 2.0 (условные CSS классы)
└── Zod 3.22 (валидация схем)

PWA И ПРОИЗВОДИТЕЛЬНОСТЬ:
├── Vite PWA Plugin 0.17 (Service Worker)
├── Workbox 7.0 (кэширование стратегии)
├── Compression и минификация
├── Code splitting по маршрутам
├── Lazy loading компонентов
├── Image optimization
├── Bundle analysis
└── Performance monitoring

РАЗРАБОТКА И ТЕСТИРОВАНИЕ:
├── ESLint 8.55 (линтер)
├── TypeScript ESLint 6.14 (TypeScript правила)
├── Vitest 1.0 (unit тестирование)
├── PostCSS 8.4 (CSS обработка)
├── Autoprefixer 10.4 (CSS префиксы)
└── Hot Module Replacement (HMR)

==============================================================================
                              СТРУКТУРА ПРОЕКТА
==============================================================================

frontend-shell/
├── public/                          # Статические файлы
│   ├── favicon.ico                  # Иконка сайта
│   ├── apple-touch-icon.png         # iOS иконка
│   ├── pwa-192x192.png             # PWA иконка
│   ├── pwa-512x512.png             # PWA иконка большая
│   ├── maskable-icon-512x512.png   # PWA маскируемая иконка
│   ├── robots.txt                   # SEO robots
│   └── manifest.json               # PWA манифест
├── src/                            # Исходный код
│   ├── components/                 # React компоненты
│   │   ├── ui/                     # Базовые UI компоненты
│   │   │   ├── Avatar.tsx          # Аватары пользователей
│   │   │   ├── Button.tsx          # Кнопки с вариантами
│   │   │   ├── Input.tsx           # Поля ввода
│   │   │   ├── SearchInput.tsx     # Поиск с автоочисткой
│   │   │   ├── Badge.tsx           # Значки и счетчики
│   │   │   └── index.ts            # Экспорт компонентов
│   │   ├── auth/                   # Компоненты аутентификации
│   │   │   ├── ECPSelector.tsx     # Выбор ЭЦП сертификата
│   │   │   ├── EGovMobileAuth.tsx  # Аутентификация через eGov Mobile
│   │   │   └── index.ts            # Экспорт auth компонентов
│   │   ├── chat/                   # Компоненты чата
│   │   │   ├── ChatHeader.tsx      # Шапка чата
│   │   │   ├── MessageList.tsx     # Список сообщений
│   │   │   ├── MessageItem.tsx     # Отдельное сообщение
│   │   │   ├── MessageComposer.tsx # Ввод сообщений
│   │   │   └── index.ts            # Экспорт чат компонентов
│   │   ├── sidebar/                # Компоненты боковой панели
│   │   │   ├── Sidebar.tsx         # Основная боковая панель
│   │   │   ├── SidebarHeader.tsx   # Шапка сайдбара
│   │   │   ├── ChatList.tsx        # Список чатов
│   │   │   ├── ChatFilters.tsx     # Фильтры чатов
│   │   │   └── index.ts            # Экспорт сайдбар компонентов
│   │   └── layout/                 # Компоненты макета
│   │       ├── MainLayout.tsx      # Основной лейаут
│   │       └── index.ts            # Экспорт лейаут компонентов
│   ├── pages/                      # Страницы приложения
│   │   ├── LoginPage.tsx           # Страница входа
│   │   ├── DashboardPage.tsx       # Главная страница (Telegram-style)
│   │   ├── FeedPage.tsx            # Страница новостной ленты
│   │   ├── ChatPage.tsx            # Страница чатов
│   │   ├── GroupsPage.tsx          # Страница групп
│   │   ├── CallsPage.tsx           # Страница звонков
│   │   ├── OrdersPage.tsx          # Страница приказов (админы)
│   │   └── index.ts                # Экспорт страниц
│   ├── stores/                     # Zustand хранилища
│   │   ├── auth.store.ts           # Аутентификация
│   │   ├── chat.store.ts           # Чаты и сообщения
│   │   ├── theme.store.ts          # Темизация
│   │   └── index.ts                # Экспорт хранилищ
│   ├── services/                   # API сервисы
│   │   ├── api.service.ts          # HTTP API клиент
│   │   ├── websocket.service.ts    # WebSocket клиент
│   │   ├── ncalayer.service.ts     # NCALayer интеграция для ЭЦП
│   │   ├── egov-mobile.service.ts  # eGov Mobile интеграция
│   │   ├── mock-certificates.ts   # Mock данные для разработки
│   │   └── index.ts                # Экспорт сервисов
│   ├── providers/                  # React провайдеры
│   │   ├── WebSocketProvider.tsx   # WebSocket контекст
│   │   ├── ThemeProvider.tsx       # Тема контекст
│   │   └── index.ts                # Экспорт провайдеров
│   ├── hooks/                      # Кастомные хуки
│   │   ├── useAuth.ts              # Аутентификация хук
│   │   ├── useChat.ts              # Чат хук
│   │   ├── useWebSocket.ts         # WebSocket хук
│   │   └── index.ts                # Экспорт хуков
│   ├── utils/                      # Утилиты
│   │   ├── api.ts                  # API хелперы
│   │   ├── date.ts                 # Дата утилиты
│   │   ├── validation.ts           # Валидация
│   │   └── index.ts                # Экспорт утилит
│   ├── styles/                     # Стили
│   │   ├── globals.css             # Глобальные стили
│   │   └── components.css          # Компонентные стили
│   ├── types/                      # Локальные типы
│   │   ├── global.d.ts             # Глобальные типы
│   │   └── api.ts                  # API типы
│   ├── App.tsx                     # Корневой компонент
│   ├── main.tsx                    # Точка входа
│   └── vite-env.d.ts              # Vite типы
├── package.json                    # Зависимости и скрипты
├── tsconfig.json                   # TypeScript конфигурация
├── tsconfig.node.json             # Node.js TypeScript конфиг
├── vite.config.ts                 # Vite конфигурация
├── tailwind.config.js             # TailwindCSS конфигурация
├── postcss.config.js              # PostCSS конфигурация
├── index.html                     # HTML шаблон
├── .env.example                   # Пример переменных окружения
├── Dockerfile                     # Docker образ
├── nginx.conf                     # Nginx конфигурация
└── README.md                      # Документация

==============================================================================
                               ДИЗАЙН СИСТЕМА
==============================================================================

ЦВЕТОВАЯ СХЕМА:
├── Основные цвета:
│   ├── Primary: #2D7DD2 (синий с бирюзой)
│   ├── Primary Dark: #1E5FA5 (темный синий)
│   ├── Secondary: #F4A261 (оранжевый акцент)
│   ├── Background: #F8FAFC (светлый фон)
│   ├── Background Dark: #1E293B (темный фон)
│   ├── Text: #1F2937 (основной текст)
│   ├── Text Light: #F9FAFB (текст на темном)
│   └── Border: #E2E8F0 (границы)
├── Расширенная палитра:
│   ├── Primary: 50-900 оттенков
│   ├── Secondary: 50-900 оттенков
│   ├── Gray: 50-900 оттенков
│   ├── Success: зеленые оттенки
│   ├── Warning: желтые оттенки
│   └── Danger: красные оттенки
└── Темная тема:
    ├── Автоматическое переключение цветов
    ├── CSS custom properties
    ├── Tailwind dark: модификаторы
    └── Плавные переходы между темами

ТИПОГРАФИКА:
├── Шрифт: Inter (Google Fonts)
├── Размеры:
│   ├── xs: 12px    # Мелкий текст
│   ├── sm: 14px    # Подписи
│   ├── base: 16px  # Основной текст
│   ├── lg: 18px    # Заголовки 3 уровня
│   ├── xl: 20px    # Заголовки 2 уровня
│   ├── 2xl: 24px   # Заголовки 1 уровня
│   └── 3xl: 30px   # Большие заголовки
├── Вес шрифта:
│   ├── light: 300    # Легкий текст
│   ├── normal: 400   # Обычный текст
│   ├── medium: 500   # Средний вес
│   ├── semibold: 600 # Полужирный
│   └── bold: 700     # Жирный
└── Семантические классы:
    ├── .text-title    # Заголовки
    ├── .text-subtitle # Подзаголовки
    ├── .text-body     # Основной текст
    └── .text-caption  # Подписи

СКРУГЛЕНИЯ:
├── sm: 0.125rem (2px)   # Мелкие элементы
├── md: 0.375rem (6px)   # Средние элементы
├── lg: 0.5rem (8px)     # Кнопки, поля
├── xl: 0.75rem (12px)   # Карточки
├── 2xl: 1rem (16px)     # Сообщения
├── 3xl: 1.5rem (24px)   # Большие карточки
├── full: 50%            # Круглые элементы
└── none: 0              # Без скругления

ОТСТУПЫ И РАЗМЕРЫ:
├── Базовая сетка: 4px (0.25rem)
├── Стандартные отступы:
│   ├── 1: 4px     # Минимальные
│   ├── 2: 8px     # Очень маленькие
│   ├── 3: 12px    # Маленькие
│   ├── 4: 16px    # Стандартные
│   ├── 6: 24px    # Большие
│   ├── 8: 32px    # Очень большие
│   └── 12: 48px   # Максимальные
├── Между элементами: gap-3 (12px)
├── Внутренние отступы: p-4 (16px)
└── Кастомные размеры:
    ├── 18: 4.5rem   # 72px
    ├── 88: 22rem    # 352px
    └── 128: 32rem   # 512px

ТЕНИ:
├── sm: 0 1px 2px rgba(0,0,0,0.05)        # Легкая тень
├── md: 0 4px 6px rgba(0,0,0,0.07)        # Средняя тень
├── lg: 0 10px 15px rgba(0,0,0,0.1)       # Большая тень
├── xl: 0 20px 25px rgba(0,0,0,0.1)       # Очень большая
└── 2xl: 0 25px 50px rgba(0,0,0,0.25)     # Драматическая

АНИМАЦИИ:
├── fade-in: opacity 0→1 (200ms)
├── slide-up: translateY(10px)→0 (300ms)
├── slide-down: translateY(-10px)→0 (300ms)
├── scale-in: scale(0.95)→1 (200ms)
├── Длительности:
│   ├── fast: 150ms      # Быстрые
│   ├── normal: 300ms    # Обычные
│   ├── slow: 500ms      # Медленные
│   └── slower: 1000ms   # Очень медленные
└── Easing:
    ├── ease-out: cubic-bezier(0, 0, 0.2, 1)
    ├── ease-in: cubic-bezier(0.4, 0, 1, 1)
    └── ease-in-out: cubic-bezier(0.4, 0, 0.2, 1)

==============================================================================
                               UI КОМПОНЕНТЫ
==============================================================================

БАЗОВЫЕ КОМПОНЕНТЫ (src/components/ui/):

Avatar.tsx - АВАТАРЫ ПОЛЬЗОВАТЕЛЕЙ:
├── Свойства:
│   ├── src?: string           # URL изображения
│   ├── alt?: string           # Alt текст
│   ├── name?: string          # Имя для инициалов
│   ├── size: xs|sm|md|lg|xl   # Размер аватара
│   ├── status?: online|offline|away|busy # Статус онлайн
│   ├── className?: string     # Дополнительные CSS классы
│   └── onClick?: () => void   # Обработчик клика
├── Возможности:
│   ├── Автогенерация инициалов из имени
│   ├── Цветовая схема на основе имени (8 цветов)
│   ├── Fallback на иконку User при отсутствии данных
│   ├── Индикатор статуса в правом нижнем углу
│   ├── Responsive размеры (6h-20h)
│   ├── Обработка ошибок загрузки изображения
│   ├── Hover эффекты при наличии onClick
│   └── Accessibility поддержка
├── Размеры:
│   ├── xs: 24px (w-6 h-6)     # Мини аватары
│   ├── sm: 32px (w-8 h-8)     # Маленькие
│   ├── md: 48px (w-12 h-12)   # Стандартные
│   ├── lg: 64px (w-16 h-16)   # Большие
│   └── xl: 80px (w-20 h-20)   # Очень большие
└── Использование:
    ├── Список чатов (md размер)
    ├── Заголовок чата (md размер)
    ├── Сообщения в группах (sm размер)
    ├── Профиль пользователя (lg размер)
    └── Настройки (xl размер)

Button.tsx - КНОПКИ С ВАРИАНТАМИ:
├── Свойства:
│   ├── variant: primary|secondary|ghost|danger # Вариант стиля
│   ├── size: sm|md|lg         # Размер кнопки
│   ├── loading?: boolean      # Состояние загрузки
│   ├── icon?: ReactNode       # Иконка кнопки
│   ├── fullWidth?: boolean    # На всю ширину
│   ├── disabled?: boolean     # Отключена
│   └── children: ReactNode    # Содержимое
├── Варианты:
│   ├── primary: синий фон, белый текст
│   ├── secondary: серый фон, темный текст
│   ├── ghost: прозрачный фон, цветной текст
│   └── danger: красный фон, белый текст
├── Размеры:
│   ├── sm: px-3 py-1.5 text-sm
│   ├── md: px-4 py-2 text-base
│   └── lg: px-6 py-3 text-lg
├── Состояния:
│   ├── Normal: базовый стиль
│   ├── Hover: изменение цвета фона
│   ├── Focus: кольцо фокуса (2px)
│   ├── Active: нажатое состояние
│   ├── Disabled: opacity 50%, cursor not-allowed
│   └── Loading: spinner вместо содержимого
└── Accessibility:
    ├── Keyboard navigation поддержка
    ├── ARIA attributes
    ├── Focus management
    └── Screen reader support

Input.tsx - ПОЛЯ ВВОДА:
├── Свойства:
│   ├── label?: string         # Метка поля
│   ├── error?: string         # Текст ошибки
│   ├── icon?: ReactNode       # Левая иконка
│   ├── rightIcon?: ReactNode  # Правая иконка
│   ├── onRightIconClick?: () => void # Клик по правой иконке
│   └── extends HTMLInputElement # Все стандартные свойства
├── Возможности:
│   ├── Автоматическое переключение пароля (type="password")
│   ├── Иконки слева и справа
│   ├── Состояния ошибки с красной подсветкой
│   ├── Label поддержка
│   ├── Placeholder стилизация
│   ├── Focus ring с брендовым цветом
│   ├── Dark theme поддержка
│   └── Responsive размеры
├── Стили:
│   ├── Border: rounded-lg, 1px solid
│   ├── Padding: px-3 py-2
│   ├── Background: white/gray-800
│   ├── Focus: ring-2 ring-primary
│   ├── Error: border-red-300, ring-red-500
│   └── Disabled: opacity-50, cursor-not-allowed
└── Типы полей:
    ├── text: обычный текст
    ├── email: email валидация
    ├── password: с переключателем видимости
    ├── number: числовой ввод
    └── tel: телефонный номер

SearchInput.tsx - ПОИСК С АВТООЧИСТКОЙ:
├── Свойства:
│   ├── value: string          # Значение поиска
│   ├── onChange: (value: string) => void # Изменение значения
│   ├── placeholder?: string   # Placeholder текст
│   ├── autoFocus?: boolean    # Автофокус
│   ├── onClear?: () => void   # Callback очистки
│   └── className?: string     # Дополнительные классы
├── Возможности:
│   ├── Иконка поиска слева (Search)
│   ├── Кнопка очистки справа (X) при наличии текста
│   ├── Keyboard shortcuts (Escape для очистки)
│   ├── Auto focus опция
│   ├── Debounced изменения (опционально)
│   ├── Responsive дизайн
│   └── Accessibility поддержка
├── Стили:
│   ├── Background: gray-100/gray-800
│   ├── Border: без границ
│   ├── Padding: pl-10 pr-10 py-2
│   ├── Border radius: rounded-lg
│   └── Focus: ring-2 ring-primary
└── Использование:
    ├── Поиск чатов в сайдбаре
    ├── Поиск пользователей
    ├── Поиск сообщений в чате
    └── Глобальный поиск

Badge.tsx - ЗНАЧКИ И СЧЕТЧИКИ:
├── Свойства:
│   ├── variant: default|primary|secondary|success|warning|danger
│   ├── size: sm|md|lg         # Размер значка
│   ├── children: ReactNode    # Содержимое
│   └── className?: string     # Дополнительные классы
├── Варианты:
│   ├── default: серый фон
│   ├── primary: синий фон с низкой прозрачностью
│   ├── secondary: оранжевый фон с низкой прозрачностью
│   ├── success: зеленый фон
│   ├── warning: желтый фон
│   └── danger: красный фон
├── Размеры:
│   ├── sm: px-2 py-0.5 text-xs
│   ├── md: px-2.5 py-1 text-sm
│   └── lg: px-3 py-1.5 text-base
├── Стили:
│   ├── Border radius: rounded-full
│   ├── Font weight: medium
│   ├── Inline flex: items-center
│   └── Color contrast: WCAG AA соответствие
└── Использование:
    ├── Счетчики непрочитанных сообщений
    ├── Статусы чатов (закреплен, новый)
    ├── Роли пользователей
    ├── Теги файлов
    └── Уведомления

==============================================================================
                         КОМПОНЕНТЫ АУТЕНТИФИКАЦИИ
==============================================================================

AUTH КОМПОНЕНТЫ (src/components/auth/):

ECPSelector.tsx - ВЫБОР ЭЦП СЕРТИФИКАТА:
├── Свойства:
│   ├── onCertificateSelect: (cert, signature) => void # Callback выбора
│   ├── isLoading?: boolean    # Состояние загрузки
│   └── className?: string     # Дополнительные классы
├── Функциональность:
│   ├── Автоматическое обнаружение NCALayer приложения
│   ├── Подключение к NCALayer через WebSocket (ws://127.0.0.1:13579)
│   ├── Получение списка доступных сертификатов
│   ├── Отображение информации о сертификатах (владелец, организация, срок действия)
│   ├── Выбор сертификата из списка
│   ├── Подпись тестовых данных выбранным сертификатом
│   ├── Mock режим при отсутствии NCALayer (для разработки)
│   └── Troubleshooting советы при проблемах подключения
├── Состояния:
│   ├── Loading: проверка доступности NCALayer
│   ├── Not installed: NCALayer не найден + инструкции
│   ├── Certificate list: список доступных сертификатов
│   ├── Signing: процесс подписи данных
│   ├── Error: ошибки подключения или подписи
│   └── Mock mode: использование тестовых сертификатов
├── UI элементы:
│   ├── Список сертификатов с полной информацией
│   ├── Кнопки управления (обновить, проверить NCALayer, сбросить)
│   ├── Загрузка сертификата из файла (placeholder)
│   ├── Troubleshooting блок с советами
│   ├── Mock mode индикатор
│   └── Error states с детальным описанием
└── Интеграция:
    ├── NCALayer WebSocket API
    ├── Mock certificates для разработки
    ├── Toast notifications для обратной связи
    ├── Certificate validation
    └── Signature generation и verification

EGovMobileAuth.tsx - АУТЕНТИФИКАЦИЯ ЧЕРЕЗ EGOV MOBILE:
├── Свойства:
│   ├── onAuthSuccess: (userData) => void # Успешная аутентификация
│   ├── onCancel?: () => void      # Отмена процесса
│   ├── isLoading?: boolean        # Состояние загрузки
│   └── className?: string         # Дополнительные классы
├── Функциональность:
│   ├── Инициализация сессии аутентификации на сервере
│   ├── Генерация QR кода для сканирования в eGov Mobile
│   ├── Deeplink для автоматического открытия приложения
│   ├── Polling статуса аутентификации каждые 2 секунды
│   ├── Автоматическая отмена сессии по таймауту (5 минут)
│   ├── Обработка статусов (pending, confirmed, cancelled, expired)
│   └── Fallback инструкции для ручного ввода кода
├── Этапы процесса:
│   ├── Initialization: создание сессии на сервере
│   ├── QR Display: показ QR кода и deeplink
│   ├── Waiting: ожидание подтверждения в приложении
│   ├── Polling: проверка статуса каждые 2 секунды
│   ├── Success: получение данных пользователя
│   └── Error/Cancel: обработка ошибок и отмены
├── UI элементы:
│   ├── QR код компонент с автоматической генерацией
│   ├── Deeplink кнопка для прямого открытия приложения
│   ├── Таймер обратного отсчета (5 минут)
│   ├── Статус индикаторы процесса
│   ├── Инструкции по использованию
│   ├── Кнопка отмены процесса
│   └── Fallback опции при проблемах
├── Интеграция:
│   ├── Backend API для создания/проверки сессий
│   ├── QR код генерация с session ID
│   ├── Deeplink схема для eGov Mobile приложения
│   ├── Polling механизм с cleanup
│   ├── Error handling и user feedback
│   └── Session timeout management
└── Безопасность:
    ├── Уникальные session ID для каждой попытки
    ├── Временные ограничения на сессии
    ├── Validation данных от eGov Mobile
    ├── CSRF protection
    └── Secure data transmission

==============================================================================
                           КОМПОНЕНТЫ ЧАТА
==============================================================================

CHAT КОМПОНЕНТЫ (src/components/chat/):

ChatHeader.tsx - ШАПКА ЧАТА:
├── Свойства:
│   ├── onBack?: () => void    # Кнопка назад (мобильные)
│   ├── onSearch?: () => void  # Поиск в чате
│   ├── onCall?: () => void    # Голосовой звонок
│   ├── onVideoCall?: () => void # Видеозвонок
│   └── className?: string     # Дополнительные классы
├── Отображаемая информация:
│   ├── Аватар чата/пользователя
│   ├── Название чата или имя пользователя
│   ├── Статус (онлайн, количество участников)
│   ├── Иконки типа чата (группа, канал, приватный)
│   ├── Значки (закреплен, приватный)
│   └── Последнее время активности
├── Действия:
│   ├── Кнопка назад (мобильные устройства)
│   ├── Поиск сообщений в чате
│   ├── Голосовой звонок (только для direct чатов)
│   ├── Видеозвонок (только для direct чатов)
│   ├── Меню с дополнительными действиями
│   └── Настройки уведомлений
├── Адаптивность:
│   ├── Desktop: показывает все кнопки
│   ├── Tablet: скрывает некоторые кнопки в меню
│   ├── Mobile: показывает только основные действия
│   └── Меню overflow для дополнительных действий
└── Интерактивность:
    ├── Hover эффекты на кнопках
    ├── Dropdown меню
    ├── Клик по аватару для профиля
    └── Keyboard navigation

MessageList.tsx - СПИСОК СООБЩЕНИЙ:
├── Свойства:
│   └── className?: string     # Дополнительные классы
├── Функциональность:
│   ├── Отображение сообщений из активного чата
│   ├── Группировка по датам с разделителями
│   ├── Группировка сообщений от одного отправителя
│   ├── Автоскролл к новым сообщениям
│   ├── Lazy loading старых сообщений
│   ├── Виртуализация для больших чатов
│   ├── Обработка состояний загрузки
│   └── Placeholder при отсутствии чата
├── Группировка сообщений:
│   ├── По датам: "Сегодня", "Вчера", "DD MMMM YYYY"
│   ├── По отправителю: в рамках 5 минут
│   ├── Показ аватара только для первого в группе
│   ├── Компактный вид для группированных
│   └── Временные метки для каждой группы
├── Типы сообщений:
│   ├── Текстовые сообщения
│   ├── Изображения с предпросмотром
│   ├── Файлы с иконками и размерами
│   ├── Видео с thumbnail
│   ├── Аудио с waveform (будущее)
│   └── Системные сообщения
├── Интерактивность:
│   ├── Клик по изображению для полного просмотра
│   ├── Скачивание файлов
│   ├── Hover меню для действий с сообщениями
│   ├── Reply на сообщения
│   └── Copy текста сообщения
└── Производительность:
    ├── React.memo для оптимизации ререндеров
    ├── Виртуализация для >100 сообщений
    ├── Intersection Observer для lazy loading
    ├── Throttled scroll обработка
    └── Кэширование рендера сообщений

MessageItem.tsx - ОТДЕЛЬНОЕ СООБЩЕНИЕ:
├── Свойства:
│   ├── message: Message       # Объект сообщения
│   ├── isOwn: boolean         # Свое сообщение
│   ├── showAvatar?: boolean   # Показывать аватар
│   ├── isGrouped?: boolean    # Группированное сообщение
│   ├── chatType: string       # Тип чата
│   └── className?: string     # Дополнительные классы
├── Виды сообщений:
│   ├── text: обычный текст с форматированием
│   ├── file: файлы с иконкой, именем, размером
│   ├── image: изображения с lazy loading
│   ├── video: видео с thumbnail
│   ├── audio: аудио с controls
│   └── system: системные уведомления
├── Стилизация:
│   ├── Исходящие: синий фон, белый текст, справа
│   ├── Входящие: серый фон, темный текст, слева
│   ├── Максимальная ширина: 70% от контейнера
│   ├── Border radius: rounded-2xl
│   ├── Padding: p-3
│   └── Margin: автоматический для выравнивания
├── Метаданные:
│   ├── Время отправки (HH:mm)
│   ├── Статус доставки (исходящие)
│   ├── Имя отправителя (входящие в группах)
│   ├── Статус прочтения
│   ├── Индикатор редактирования
│   └── Reply информация
├── Интерактивность:
│   ├── Hover меню с действиями
│   ├── Double-click для quick reply
│   ├── Right-click context menu
│   ├── Long press на мобильных
│   ├── Swipe для reply (мобильные)
│   └── Keyboard shortcuts
└── Accessibility:
    ├── ARIA labels для screen readers
    ├── Keyboard navigation
    ├── High contrast поддержка
    ├── Voice over поддержка
    └── Semantic markup

MessageComposer.tsx - ВВОД СООБЩЕНИЙ:
├── Свойства:
│   └── className?: string     # Дополнительные классы
├── Основные элементы:
│   ├── Textarea для ввода текста с автоизменением высоты
│   ├── Кнопка прикрепления файлов
│   ├── Кнопка эмодзи (placeholder)
│   ├── Кнопка отправки/записи голоса
│   └── Превью прикрепленных файлов
├── Функциональность:
│   ├── Автоизменение высоты textarea (1-6 строк)
│   ├── Отправка по Enter (Shift+Enter для новой строки)
│   ├── Прикрепление множественных файлов
│   ├── Превью файлов с возможностью удаления
│   ├── Drag & drop файлов
│   ├── Paste изображений из clipboard
│   ├── Voice recording (placeholder)
│   └── Typing indicators для других пользователей
├── Валидация:
│   ├── Максимальная длина сообщения (4000 символов)
│   ├── Проверка типов файлов
│   ├── Ограничение размера файлов
│   ├── Количество файлов за раз
│   └── Spam protection
├── Состояния:
│   ├── Empty: только кнопка голосовой записи
│   ├── With text: кнопка отправки
│   ├── With files: кнопка отправки + превью
│   ├── Sending: loading состояние
│   ├── Error: показ ошибок отправки
│   └── Disabled: когда чат недоступен
├── Keyboard shortcuts:
│   ├── Enter: отправить сообщение
│   ├── Shift+Enter: новая строка
│   ├── Ctrl+V: вставить файлы
│   ├── Escape: очистить/отменить
│   └── Ctrl+Z: undo (при наличии draft)
└── Accessibility:
    ├── Screen reader поддержка
    ├── Keyboard navigation
    ├── ARIA live regions для статусов
    ├── Focus management
    └── Voice control готовность

==============================================================================
                           КОМПОНЕНТЫ САЙДБАРА
==============================================================================

SIDEBAR КОМПОНЕНТЫ (src/components/sidebar/):

Sidebar.tsx - ОСНОВНАЯ БОКОВАЯ ПАНЕЛЬ:
├── Свойства:
│   ├── className?: string     # Дополнительные классы
│   ├── isMobile?: boolean     # Мобильный режим
│   └── onClose?: () => void   # Закрытие (мобильные)
├── Структура:
│   ├── SidebarHeader - шапка с профилем пользователя
│   ├── SearchInput - поиск чатов
│   ├── ChatFilters - фильтры по типам чатов
│   ├── ChatList - список чатов
│   └── Дополнительные панели (настройки, боты)
├── Адаптивность:
│   ├── Desktop: фиксированная ширина 320px
│   ├── Tablet: может сворачиваться
│   ├── Mobile: overlay с возможностью закрытия
│   └── Animations для show/hide
├── Состояния:
│   ├── Expanded: полная панель с текстом
│   ├── Collapsed: только иконки (будущее)
│   ├── Hidden: скрыта на мобильных
│   └── Loading: skeleton loading
└── Взаимодействие:
    ├── Swipe gestures на мобильных
    ├── Click outside для закрытия
    ├── Keyboard shortcuts (Ctrl+B toggle)
    ├── Resize handle для изменения ширины
    └── Drag & drop для reorder чатов

SidebarHeader.tsx - ШАПКА САЙДБАРА:
├── Свойства:
│   ├── onClose?: () => void   # Закрытие мобильного сайдбара
│   └── className?: string     # Дополнительные классы
├── Отображаемые элементы:
│   ├── Аватар текущего пользователя с онлайн статусом
│   ├── Имя и должность пользователя
│   ├── Переключатель темы (светлая/темная/системная)
│   ├── Кнопка создания нового чата
│   ├── Кнопка настроек
│   └── Кнопка меню (мобильные)
├── Функциональность:
│   ├── Dropdown меню темы с тремя опциями
│   ├── Quick actions (новый чат, настройки)
│   ├── Профиль пользователя при клике на аватар
│   ├── Уведомления о новых сообщениях
│   ├── Status indicator (онлайн/оффлайн/занят)
│   └── Logout опция в меню
├── Темизация:
│   ├── Light theme: светлые цвета
│   ├── Dark theme: темные цвета
│   ├── System theme: следует системным настройкам
│   ├── Плавные переходы между темами
│   └── Сохранение выбора в localStorage
└── Интерактивность:
    ├── Hover эффекты на кнопках
    ├── Dropdown меню с анимациями
    ├── Click outside для закрытия меню
    ├── Keyboard navigation
    └── Touch gestures поддержка

ChatList.tsx - СПИСОК ЧАТОВ:
├── Свойства:
│   └── className?: string     # Дополнительные классы
├── Функциональность:
│   ├── Отображение всех чатов пользователя
│   ├── Фильтрация по типам (все, каналы, группы, личные)
│   ├── Поиск по названию чата и последним сообщениям
│   ├── Сортировка по времени последнего сообщения
│   ├── Виртуализация для большого количества чатов
│   ├── Lazy loading при скролле
│   ├── Pull-to-refresh на мобильных
│   └── Empty states при отсутствии чатов
├── Элементы чата:
│   ├── Аватар чата/пользователя
│   ├── Название чата
│   ├── Последнее сообщение (truncated)
│   ├── Время последнего сообщения
│   ├── Счетчик непрочитанных сообщений
│   ├── Иконка типа чата (группа/канал/бот)
│   ├── Статус пользователя (для direct чатов)
│   ├── Индикатор печати
│   └── Pin/Mute индикаторы
├── Интерактивность:
│   ├── Click для выбора чата
│   ├── Right-click context menu
│   ├── Long press на мобильных
│   ├── Swipe actions (archive, mute, delete)
│   ├── Keyboard navigation (arrow keys)
│   ├── Search highlight найденного текста
│   └── Drag & drop для reorder (pinned чаты)
├── Состояния:
│   ├── Active: выбранный чат
│   ├── Unread: с непрочитанными сообщениями
│   ├── Muted: приглушенные уведомления
│   ├── Pinned: закрепленные сверху
│   ├── Archived: архивированные (скрыты)
│   └── Loading: skeleton loading новых чатов
└── Производительность:
    ├── React.memo для предотвращения ненужных ререндеров
    ├── Виртуализация для >50 чатов
    ├── Debounced search
    ├── Memoized фильтрация и сортировка
    └── Intersection Observer для lazy loading

ChatFilters.tsx - ФИЛЬТРЫ ЧАТОВ:
├── Свойства:
│   └── className?: string     # Дополнительные классы
├── Доступные фильтры:
│   ├── "Все" - показать все чаты
│   ├── "Каналы" - только публичные каналы
│   ├── "Группы" - только групповые чаты
│   ├── "Личные" - только direct чаты
│   └── "Боты" - только чаты с ботами (будущее)
├── Отображение:
│   ├── Горизонтальный ряд кнопок-фильтров
│   ├── Иконки для каждого типа (Hash, Users, MessageCircle, Bot)
│   ├── Названия фильтров
│   ├── Счетчики количества чатов каждого типа
│   └── Активный фильтр выделен синим цветом
├── Функциональность:
│   ├── Переключение между фильтрами
│   ├── Автоматический подсчет чатов для каждого типа
│   ├── Сохранение выбранного фильтра в localStorage
│   ├── Keyboard navigation (Tab, Enter)
│   ├── Touch/click поддержка
│   └── Smooth transitions между состояниями
├── Стилизация:
│   ├── Compact layout с minimal padding
│   ├── Rounded buttons с hover эффектами
│   ├── Badge счетчики рядом с названиями
│   ├── Responsive для мобильных (может стать dropdown)
│   └── Dark/light theme поддержка
└── Accessibility:
    ├── ARIA labels для screen readers
    ├── Keyboard navigation support
    ├── High contrast режим
    ├── Focus indicators
    └── Semantic markup (role="tablist")

==============================================================================
                            LAYOUT КОМПОНЕНТЫ
==============================================================================

MainLayout.tsx - ОСНОВНОЙ ЛЕЙАУТ:
├── Свойства:
│   └── className?: string     # Дополнительные классы
├── Структура:
│   ├── Sidebar (левая панель)
│   ├── Chat area (правая панель)
│   │   ├── ChatHeader
│   │   ├── MessageList
│   │   └── MessageComposer
│   └── Mobile overlay для sidebar
├── Адаптивное поведение:
│   ├── Desktop (lg+): двухпанельный вид
│   │   ├── Sidebar: фиксированная ширина 320px
│   │   ├── Chat: занимает оставшееся пространство
│   │   └── Оба компонента видны одновременно
│   ├── Tablet (md-lg): адаптивный вид
│   │   ├── Sidebar: может скрываться
│   │   ├── Chat: может занимать полную ширину
│   │   └── Toggle кнопка для sidebar
│   └── Mobile (<md): однопанельный вид
│       ├── Показывает либо sidebar, либо chat
│       ├── Переключение между панелями
│       ├── Кнопка "назад" в chat header
│       └── Sidebar как overlay поверх chat
├── State management:
│   ├── showSidebar: boolean для мобильных
│   ├── activeChat: выбранный чат
│   ├── Автоматическое скрытие sidebar при выборе чата (мобильные)
│   └── Breadcrumb навигация для мобильных
├── Gestures и interaction:
│   ├── Swipe right: показать sidebar (мобильные)
│   ├── Swipe left: скрыть sidebar (мобильные)
│   ├── Click outside: закрыть sidebar overlay
│   ├── ESC key: закрыть sidebar/модалы
│   └── Browser back button handling
└── Performance optimizations:
    ├── Lazy loading chat компонентов
    ├── Virtualized списки для больших чатов
    ├── Debounced resize handlers
    ├── Memoized component renders
    └── Efficient state updates

==============================================================================
                           СТРАНИЦЫ ПРИЛОЖЕНИЯ
==============================================================================

LoginPage.tsx - СТРАНИЦА ВХОДА:
├── Структура:
│   ├── Centered layout с максимальной шириной 400px
│   ├── Logo и название платформы
│   ├── Переключатель методов аутентификации (ЭЦП/eGov Mobile)
│   ├── Динамическая форма в зависимости от выбранного метода
│   ├── Error states и loading состояния
│   └── Footer с контактами и ссылками
├── Методы аутентификации:
│   ├── ЭЦП на ПК (через NCALayer):
│   │   ├── Автоматическое обнаружение NCALayer
│   │   ├── Список доступных сертификатов
│   │   ├── Выбор сертификата из списка
│   │   ├── Подпись тестовых данных
│   │   ├── Mock режим при отсутствии NCALayer
│   │   └── Troubleshooting советы
│   └── eGov Mobile:
│       ├── Генерация QR кода для сканирования
│       ├── Deeplink для автоматического открытия приложения
│       ├── Polling статуса аутентификации
│       ├── Таймаут сессии и автоматическая отмена
│       └── Fallback инструкции для ручного ввода
├── Валидация:
│   ├── Real-time валидация email поля
│   ├── Required field индикаторы
│   ├── Error messages под полями
│   ├── Form submission validation
│   ├── Network error handling
│   └── Rate limiting feedback
├── Дизайн:
│   ├── Gradient background с брендовыми цветами
│   ├── Glass morphism карточка формы
│   ├── Smooth animations для появления элементов
│   ├── Responsive для мобильных устройств
│   ├── Dark theme поддержка
│   └── High contrast accessibility
├── Функциональность:
│   ├── Auto-redirect если уже авторизован
│   ├── Remember me через localStorage
│   ├── Password visibility toggle
│   ├── Keyboard shortcuts (Enter для submit)
│   ├── Focus management
│   └── Error recovery flows
└── Security:
    ├── Certificate validation для ЭЦП
    ├── Session security для eGov Mobile
    ├── CSRF protection
    ├── Input sanitization
    ├── Rate limiting визуальная обратная связь
    └── Secure data transmission

DashboardPage.tsx - ГЛАВНАЯ СТРАНИЦА:
├── Структура:
│   └── MainLayout обертка - содержит полный Telegram-style интерфейс
├── Функциональность:
│   ├── Отображение основного интерфейса приложения
│   ├── Sidebar с навигацией и списком чатов
│   ├── Chat area для работы с сообщениями
│   ├── Адаптивное поведение на разных устройствах
│   └── Интеграция всех основных функций платформы
├── Философия дизайна:
│   ├── Telegram-подобный интерфейс как основа
│   ├── Двухпанельная структура (sidebar + content)
│   ├── Минималистичный подход без лишних элементов
│   ├── Фокус на коммуникации как основной функции
│   └── Быстрый доступ к чатам, группам, каналам
└── Интеграция:
    ├── WebSocket для real-time обновлений
    ├── Zustand store для управления состоянием
    ├── React Router для навигации
    ├── PWA capabilities для mobile experience
    └── Theme system для персонализации

==============================================================================
                           STATE MANAGEMENT
==============================================================================

ZUSTAND STORES (src/stores/):

auth.store.ts - АУТЕНТИФИКАЦИЯ:
├── State:
│   ├── user: User | null           # Данные пользователя
│   ├── token: string | null        # JWT access token
│   ├── refreshToken: string | null # JWT refresh token
│   ├── isAuthenticated: boolean    # Статус аутентификации
│   ├── isLoading: boolean          # Состояние загрузки
│   └── error: string | null        # Ошибки аутентификации
├── Actions:
│   ├── setAuth(user, token, refreshToken) # Установить данные auth
│   ├── logout()                    # Выйти из системы
│   ├── setUser(user)              # Обновить данные пользователя
│   ├── setLoading(loading)        # Установить состояние загрузки
│   ├── setError(error)            # Установить ошибку
│   └── clearError()               # Очистить ошибку
├── Persistence:
│   ├── localStorage сохранение user, token, refreshToken
│   ├── Автоматическое восстановление при перезагрузке
│   ├── Очистка данных при logout
│   └── Selective persistence (не сохраняем isLoading, error)
├── Side effects:
│   ├── Автоматический logout при истечении refresh token
│   ├── Redirect на login page при logout
│   ├── API interceptor integration для auto token refresh
│   └── Sync между вкладками браузера
└── Integration:
    ├── React Router для protected routes
    ├── API service для автоматического добавления токенов
    ├── WebSocket service для аутентификации соединения
    └── Error boundary для обработки auth ошибок

chat.store.ts - ЧАТЫ И СООБЩЕНИЯ:
├── State:
│   ├── chats: Chat[]               # Все чаты пользователя
│   ├── activeChat: Chat | null     # Активный/выбранный чат
│   ├── messages: Record<string, Message[]> # Сообщения по chatId
│   ├── isLoading: boolean          # Состояние загрузки
│   ├── error: string | null        # Ошибки чатов
│   ├── searchQuery: string         # Поисковый запрос
│   ├── filter: 'all'|'channels'|'groups'|'direct' # Фильтр чатов
│   └── unreadCounts: Record<string, number> # Непрочитанные по chatId
├── Actions:
│   ├── setChats(chats)            # Установить список чатов
│   ├── addChat(chat)              # Добавить новый чат
│   ├── updateChat(chatId, updates) # Обновить данные чата
│   ├── removeChat(chatId)         # Удалить чат
│   ├── setActiveChat(chat)        # Установить активный чат
│   ├── setMessages(chatId, messages) # Установить сообщения чата
│   ├── addMessage(chatId, message) # Добавить новое сообщение
│   ├── updateMessage(chatId, messageId, updates) # Обновить сообщение
│   ├── setLoading(loading)        # Установить состояние загрузки
│   ├── setError(error)            # Установить ошибку
│   ├── setSearchQuery(query)      # Установить поисковый запрос
│   ├── setFilter(filter)          # Установить фильтр чатов
│   ├── setUnreadCount(chatId, count) # Установить счетчик непрочитанных
│   ├── incrementUnreadCount(chatId) # Увеличить счетчик
│   └── clearUnreadCount(chatId)   # Очистить счетчик
├── Computed/Selectors:
│   ├── filteredChats - чаты с применением фильтра и поиска
│   ├── sortedChats - чаты отсортированные по времени
│   ├── totalUnreadCount - общее количество непрочитанных
│   ├── activeChatMessages - сообщения активного чата
│   └── chatParticipants - участники активного чата
├── Side effects:
│   ├── Автоматическая сортировка чатов при новых сообщениях
│   ├── Обновление lastMessage в чате при новом сообщении
│   ├── Очистка unread count при выборе чата
│   ├── WebSocket integration для real-time обновлений
│   └── Local storage кэширование для быстрого startup
└── Optimizations:
    ├── Memoized selectors для производительности
    ├── Batched updates для множественных изменений
    ├── Debounced search для оптимизации
    ├── Lazy loading сообщений старых чатов
    └── Memory management для больших чатов

theme.store.ts - ТЕМИЗАЦИЯ:
├── State:
│   ├── theme: 'light'|'dark'|'system' # Выбранная тема
│   └── actualTheme: 'light'|'dark'    # Реальная применяемая тема
├── Actions:
│   ├── setTheme(theme)            # Установить тему
│   └── toggleTheme()              # Переключить между light/dark
├── System integration:
│   ├── Listening to system theme changes через media queries
│   ├── Автоматическое применение system theme при выборе
│   ├── CSS class toggle на document.documentElement
│   └── Smooth transitions между темами
├── Persistence:
│   ├── localStorage сохранение выбранной темы
│   ├── Автовосстановление при загрузке страницы
│   └── Sync между вкладками браузера
├── CSS Integration:
│   ├── Tailwind dark: prefix для темных стилей
│   ├── CSS custom properties для динамических цветов
│   ├── Transition animations для smooth switching
│   └── High contrast поддержка
└── Accessibility:
    ├── Respect system preferences по умолчанию
    ├── WCAG color contrast compliance
    ├── Reduced motion поддержка
    ├── Screen reader announcements при смене темы
    └── Keyboard shortcuts для быстрого переключения

==============================================================================
                              API СЕРВИСЫ
==============================================================================

api.service.ts - HTTP API КЛИЕНТ:
├── Основной класс ApiService с singleton pattern
├── Axios instance с базовой конфигурацией:
│   ├── baseURL: /api/v1 (через env variable)
│   ├── timeout: 30 секунд
│   ├── Content-Type: application/json
│   └── Custom headers для трекинга
├── Request interceptor:
│   ├── Автоматическое добавление Authorization header
│   ├── CSRF token handling
│   ├── Request ID для трекинга
│   └── Logging исходящих запросов
├── Response interceptor:
│   ├── Автоматический refresh токенов при 401
│   ├── Queue для запросов во время refresh
│   ├── Error handling и notification показ
│   ├── Response time tracking
│   └── Automatic retry для network errors
├── Auth endpoints:
│   ├── login(credentials) - вход через email/password (legacy)
│   ├── loginWithECP(certificate, signature) - вход через ЭЦП
│   ├── loginWithEGovMobile(sessionId) - вход через eGov Mobile
│   ├── refresh(refreshToken) - обновление токена
│   ├── logout() - выход из системы
│   └── getCurrentUser() - данные текущего пользователя
├── User endpoints:
│   ├── getUserProfile() - профиль пользователя
│   ├── updateUserProfile(data) - обновление профиля
│   ├── searchUsers(query) - поиск пользователей
│   ├── getUserContacts() - список контактов
│   └── addContact(userId) - добавить контакт
├── Chat endpoints:
│   ├── getUserChats(page, limit) - чаты пользователя
│   ├── createChat(data) - создать чат
│   ├── getChatMessages(chatId, page, limit) - сообщения чата
│   └── sendMessage(data) - отправить сообщение
├── File endpoints:
│   ├── uploadFile(file, options) - загрузить файл
│   ├── getUserFiles(page, limit, type) - файлы пользователя
│   ├── getFileInfo(fileId) - информация о файле
│   ├── generateFileUrl(fileId, expiresIn) - временная ссылка
│   └── deleteFile(fileId) - удалить файл
├── Error handling:
│   ├── Network errors - toast notification
│   ├── Server errors (5xx) - generic error message
│   ├── Client errors (4xx) - specific error from server
│   ├── Timeout errors - retry suggestion
│   └── CORS errors - configuration guidance
└── Performance optimizations:
    ├── Request/response caching через React Query
    ├── Automatic request deduplication
    ├── Response compression support
    ├── Connection pooling и keep-alive
    └── Retry logic с exponential backoff

==============================================================================
                            WEBSOCKET ИНТЕГРАЦИЯ
==============================================================================

WebSocketProvider.tsx - WEBSOCKET КОНТЕКСТ:
├── Socket.IO client конфигурация:
│   ├── URL: ws://localhost:8080 (через env variable)
│   ├── Auth: JWT token передача
│   ├── transports: ['websocket'] для лучшей производительности
│   ├── autoConnect: false для ручного управления
│   └── timeout: 20 секунд для connection
├── Connection lifecycle:
│   ├── Подключение при наличии authenticated user
│   ├── Автоматическое переподключение при потере соединения
│   ├── Graceful disconnect при logout
│   ├── Reconnection с exponential backoff
│   └── Connection state tracking (connecting, connected, disconnected)
├── Event handling:
│   ├── 'connect' - успешное подключение
│   ├── 'disconnect' - потеря соединения
│   ├── 'connect_error' - ошибка подключения
│   ├── 'reconnect' - переподключение
│   └── 'error' - общие ошибки
├── Chat events:
│   ├── 'message:new' - новое сообщение получено
│   ├── 'message:updated' - сообщение обновлено
│   ├── 'message:deleted' - сообщение удалено
│   ├── 'chat:updated' - чат обновлен
│   ├── 'user:typing' - пользователь печатает
│   ├── 'user:stopped_typing' - перестал печатать
│   └── 'user:online_status' - изменение онлайн статуса
├── Room management:
│   ├── join_chat(chatId) - присоединиться к комнате чата
│   ├── leave_chat(chatId) - покинуть комнату чата
│   ├── Автоматический join при выборе активного чата
│   └── Cleanup при смене чата
├── Integration с stores:
│   ├── Zustand chat store для обновления сообщений
│   ├── Auth store для токена аутентификации
│   ├── Notification показ для новых сообщений
│   └── UI updates для typing indicators
├── Error recovery:
│   ├── Automatic reconnection при network issues
│   ├── Token refresh при authentication errors
│   ├── Fallback на HTTP polling при WebSocket недоступности
│   ├── Queue сообщений во время disconnection
│   └── Sync состояния после reconnection
└── Performance optimizations:
    ├── Event listener cleanup при unmount
    ├── Debounced typing events
    ├── Message batching для множественных updates
    ├── Memory leak prevention
    └── Connection pooling для multiple tabs

==============================================================================
                              PWA КОНФИГУРАЦИЯ
==============================================================================

PROGRESSIVE WEB APP SETUP:

Service Worker (через Vite PWA Plugin):
├── Workbox strategies:
│   ├── NetworkFirst для API запросов
│   ├── CacheFirst для статических ресурсов
│   ├── StaleWhileRevalidate для изображений
│   └── NetworkOnly для real-time данных
├── Caching strategies:
│   ├── Static assets: cache с версионированием
│   ├── API responses: network first с fallback
│   ├── Images: cache с TTL
│   ├── Fonts: cache indefinitely
│   └── HTML: network first для свежести
├── Background sync:
│   ├── Offline message queue
│   ├── Failed request retry
│   ├── Data synchronization при reconnection
│   └── Background app updates
└── Push notifications (готовность):
    ├── Service worker registration
    ├── Permission request flow
    ├── Notification click handling
    └── Badge updates

Manifest (manifest.json):
├── App identity:
│   ├── name: "Платформа госслужащих"
│   ├── short_name: "ГосПлатформа"
│   ├── description: "Защищённая платформа для коммуникации"
│   └── lang: "ru"
├── Display options:
│   ├── display: "standalone"
│   ├── orientation: "portrait"
│   ├── theme_color: "#2D7DD2"
│   ├── background_color: "#ffffff"
│   └── scope: "/"
├── Icons:
│   ├── 64x64 - малая иконка
│   ├── 192x192 - стандартная иконка
│   ├── 512x512 - большая иконка
│   └── maskable-512x512 - адаптивная иконка
├── Installation:
│   ├── Install prompt customization
│   ├── Add to home screen guidance
│   ├── Desktop installation support
│   └── Update availability notification
└── Capabilities:
    ├── File handling associations
    ├── Share target (получение файлов из других приложений)
    ├── Protocol handlers
    └── Shortcuts в контекстном меню

Offline Support:
├── Offline indicator в UI
├── Cached pages доступны offline
├── Message queue для отправки при reconnection
├── Local storage для критических данных
├── Sync индикатор для pending changes
├── Graceful degradation функциональности
└── Offline-first design для core features

Installation Experience:
├── Custom install prompt вместо browser default
├── Install instructions для разных платформ
├── App update notifications
├── Splash screen кастомизация
├── Launch handling из home screen
└── Desktop integration (Windows, macOS, Linux)

==============================================================================
                            BUILD И DEPLOYMENT
==============================================================================

VITE КОНФИГУРАЦИЯ:

Development Server:
├── Host: 0.0.0.0 для доступа извне
├── Port: 3000
├── Hot Module Replacement (HMR)
├── Proxy configuration:
│   ├── /api → http://localhost:8080 (API Gateway)
│   └── /socket.io → http://localhost:8080 (WebSocket)
├── HTTPS support для PWA testing
├── Environment variables loading
└── Source maps для debugging

Build Optimization:
├── Code splitting по маршрутам
├── Vendor chunk splitting:
│   ├── vendor: React, React DOM, React Router
│   ├── ui: Lucide React, Clsx, Framer Motion
│   ├── stores: Zustand
│   └── api: Axios, Socket.IO Client
├── Tree shaking неиспользуемого кода
├── Minification и compression
├── Asset optimization:
│   ├── Image compression
│   ├── CSS purging
│   ├── Font subsetting
│   └── SVG optimization
├── Bundle analysis tools
└── Performance budgets

Production Build:
├── TypeScript compilation
├── TailwindCSS purging
├── PostCSS processing с autoprefixer
├── Service Worker generation
├── Manifest generation
├── Sitemap generation
├── Static asset versioning
└── Deployment artifacts

Docker Configuration:
├── Multi-stage build:
│   ├── Dependencies stage
│   ├── Build stage
│   └── Runtime stage (Nginx)
├── Nginx configuration:
│   ├── Static file serving
│   ├── API proxying
│   ├── WebSocket proxying
│   ├── Compression
│   ├── Caching headers
│   ├── Security headers
│   └── SPA routing support
├── Health checks
├── Environment variable injection
└── Production optimizations

==============================================================================
                           ПРОИЗВОДИТЕЛЬНОСТЬ
==============================================================================

PERFORMANCE OPTIMIZATIONS:

React Optimizations:
├── React.memo для предотвращения ненужных ререндеров
├── useMemo для дорогих вычислений
├── useCallback для стабилизации функций
├── Lazy loading компонентов через React.lazy
├── Suspense boundaries для loading states
├── Code splitting на уровне маршрутов
├── Bundle splitting для vendor кода
└── Profiler использование для измерения производительности

List Virtualization:
├── React Window для больших списков сообщений
├── Virtualized Auto Sizer для автоматического размера
├── Intersection Observer для lazy loading
├── Debounced scroll handlers
├── Memoized list items
├── Efficient key strategies
└── Memory cleanup для unmounted items

State Management:
├── Zustand с minimal re-renders
├── Selector optimization для specific data
├── Batched updates для множественных изменений
├── Memoized computed values
├── Lazy state initialization
├── State normalization для nested data
└── Cleanup unused state при unmount

Network Optimizations:
├── React Query для caching и deduplication
├── Request batching для множественных API calls
├── Debounced search requests
├── Image lazy loading с intersection observer
├── WebSocket connection sharing
├── Service Worker caching strategies
├── CDN готовые статические ресурсы
└── Compression на всех уровнях

Bundle Optimizations:
├── Tree shaking неиспользуемых модулей
├── Code splitting по функциональности
├── Dynamic imports для conditional features
├── Vendor chunk optimization
├── Asset pipeline optimization
├── CSS purging неиспользуемых стилей
├── Font subsetting для faster loading
└── Image format optimization (WebP, AVIF)

Runtime Performance:
├── Efficient DOM updates через React reconciliation
├── Minimal layout thrashing
├── CSS-in-JS optimizations через Tailwind
├── Event delegation для better memory usage
├── Debounced/throttled event handlers
├── Web Workers для heavy computations (готовность)
├── Memory leak prevention
└── Browser DevTools integration для debugging

ОЖИДАЕМЫЕ ХАРАКТЕРИСТИКИ:
├── First Contentful Paint (FCP): <1.5s
├── Largest Contentful Paint (LCP): <2.5s
├── First Input Delay (FID): <100ms
├── Cumulative Layout Shift (CLS): <0.1
├── Time to Interactive (TTI): <3.5s
├── Bundle size: <1MB (gzipped)
├── Initial load: <3s на 3G
├── Hot reload time: <1s
├── Memory usage: <50MB в idle
└── Scroll performance: 60fps

==============================================================================
                            ACCESSIBILITY
==============================================================================

ДОСТУПНОСТЬ И ИНКЛЮЗИВНОСТЬ:

WCAG 2.1 AA Compliance:
├── Color contrast 4.5:1 для обычного текста
├── Color contrast 3:1 для large text
├── No information conveyed by color alone
├── Focus indicators для всех интерактивных элементов
├── Alt text для всех изображений
├── Semantic HTML markup
├── Heading hierarchy (h1-h6)
└── Language declaration

Keyboard Navigation:
├── Tab order логический и предсказуемый
├── Все интерактивные элементы accessible via keyboard
├── Escape key для закрытия модалов/меню
├── Arrow keys для navigation в списках
├── Enter/Space для activation
├── Skip links для navigation shortcuts
├── Focus trap в модальных окнах
└── Focus management при route changes

Screen Reader Support:
├── ARIA labels для custom elements
├── ARIA live regions для dynamic content
├── ARIA expanded/collapsed для collapsible content
├── ARIA current для active navigation items
├── Role attributes для custom components
├── Landmark roles для page structure
├── Screen reader только текст где необходимо
└── Testing с NVDA/JAWS/VoiceOver

Motor Impairments:
├── Large click targets (minimum 44px)
├── Sufficient spacing между интерактивными элементами
├── No fine motor skill requirements
├── Customizable timeout settings
├── Pause/stop для moving content
├── Alternative input methods support
├── Sticky hover states avoidance
└── Gesture alternatives для touch interfaces

Cognitive Accessibility:
├── Clear и consistent navigation
├── Predictable functionality
├── Error prevention и clear error messages
├── Help и instructions где необходимо
├── Simple language использование
├── Consistent terminology
├── Progress indicators для long processes
└── Undo functionality для critical actions

Visual Accessibility:
├── High contrast mode поддержка
├── Zoom до 200% без horizontal scrolling
├── Text spacing customizable
├── Reduced motion preferences respect
├── Focus indicators clearly visible
├── Text alternatives для visual information
├── Color не единственный способ conveying information
└── Customizable font sizes

Assistive Technology:
├── Voice control software compatibility
├── Switch navigation support
├── Eye tracking software готовность
├── Screen magnifier compatibility
├── Dragon NaturallySpeaking support
├── iOS VoiceOver optimization
├── Android TalkBack optimization
└── Windows Narrator compatibility

==============================================================================
                               ТЕСТИРОВАНИЕ
==============================================================================

TESTING STRATEGY:

Unit Testing (Vitest):
├── Component testing с React Testing Library
├── Hook testing с @testing-library/react-hooks
├── Store testing для Zustand stores
├── Utility functions testing
├── API service testing с mocked responses
├── WebSocket service testing
├── Form validation testing
└── Edge case handling

Integration Testing:
├── Component interaction testing
├── Store integration с components
├── API integration testing
├── WebSocket integration testing
├── Authentication flow testing
├── File upload flow testing
├── Chat functionality testing
└── Theme switching testing

E2E Testing (планируется):
├── User authentication flow
├── Chat creation и messaging
├── File upload и sharing
├── Search functionality
├── Mobile responsive testing
├── PWA installation testing
├── Offline functionality testing
└── Performance regression testing

Accessibility Testing:
├── Automated accessibility testing с axe-core
├── Keyboard navigation testing
├── Screen reader testing
├── Color contrast validation
├── Focus management testing
├── ARIA attributes validation
├── Semantic markup validation
└── Mobile accessibility testing

Performance Testing:
├── Bundle size monitoring
├── Core Web Vitals measurement
├── Memory leak detection
├── Network performance testing
├── Rendering performance profiling
├── User interaction responsiveness
├── Third-party script impact
└── Progressive loading testing

Visual Regression Testing:
├── Component visual consistency
├── Theme switching visual testing
├── Responsive design validation
├── Cross-browser rendering
├── Animation consistency
├── Icon и typography consistency
├── Dark/light theme parity
└── Mobile visual testing

Test Coverage:
├── Code coverage target: >80%
├── Critical path coverage: 100%
├── Error handling coverage
├── Edge case coverage
├── Browser compatibility testing
├── Performance regression detection
└── Security vulnerability scanning

==============================================================================
                                КОМАНДЫ
==============================================================================

DEVELOPMENT COMMANDS:
├── npm run dev              # Запуск development server
├── npm run build            # Production build
├── npm run preview          # Preview production build
├── npm run lint             # ESLint проверка
├── npm run lint:fix         # ESLint автофикс
├── npm run type-check       # TypeScript проверка
├── npm run test             # Unit тесты
├── npm run test:watch       # Тесты в watch mode
├── npm run test:coverage    # Тесты с coverage
├── npm run test:ui          # Vitest UI interface
└── npm run analyze          # Bundle analyzer

BUILD COMMANDS:
├── npm run build:dev        # Development build
├── npm run build:staging    # Staging build
├── npm run build:prod       # Production build
├── npm run build:analyze    # Build с bundle analysis
└── npm run build:docker     # Docker build

DEPLOYMENT COMMANDS:
├── docker build -t frontend-shell .
├── docker run -p 3000:80 frontend-shell
├── docker-compose up frontend-shell
└── kubectl apply -f k8s/frontend-deployment.yaml

MAINTENANCE COMMANDS:
├── npm run clean            # Очистка build artifacts
├── npm run deps:update      # Обновление зависимостей
├── npm run deps:audit       # Аудит безопасности
├── npm run format           # Prettier форматирование
└── npm run generate         # Code generation (если есть)

==============================================================================


====================================
2. ОПИСАНИЕ ТЕКУЩЕГО БЭКЕНДА
====================================
==============================================================================
                    ОПИСАНИЕ БЭКЕНДА ПЛАТФОРМЫ ГОССЛУЖАЩИХ
==============================================================================

ОБЩАЯ АРХИТЕКТУРА:
├── Микросервисная архитектура на Node.js + TypeScript
├── API Gateway как единая точка входа 
├── 5 основных микросервисов
├── 6 инфраструктурных компонентов
├── Docker контейнеризация
└── Kubernetes готовность

==============================================================================
                              МИКРОСЕРВИСЫ
==============================================================================

1. AUTH SERVICE (порт 3001) - АУТЕНТИФИКАЦИЯ
──────────────────────────────────────────────────────────────────────────────
Назначение: Управление аутентификацией через ЭЦП и авторизацией пользователей

Технологии:
├── Node.js 18 + TypeScript 5.5
├── Express.js 4.18 (HTTP сервер)
├── JWT токены (Access + Refresh)
├── Redis для хранения сессий
├── Crypto для валидации ЭЦП
└── Winston для логирования

Структура кода:
auth-service/
├── src/
│   ├── config/
│   │   └── index.ts              # Конфигурация окружения
│   ├── controllers/
│   │   └── auth.controller.ts    # HTTP контроллеры
│   ├── services/
│   │   └── auth.service.ts       # Бизнес-логика
│   ├── middleware/
│   │   ├── auth.middleware.ts    # Проверка токенов
│   │   └── validation.middleware.ts # Валидация запросов
│   ├── routes/
│   │   ├── auth.routes.ts        # Маршруты аутентификации
│   │   └── index.ts              # Сборка маршрутов
│   ├── utils/
│   │   ├── crypto.ts             # ЭЦП утилиты
│   │   ├── jwt.ts                # JWT утилиты
│   │   └── logger.ts             # Логирование
│   ├── app.ts                    # Express приложение
│   └── index.ts                  # Точка входа
├── package.json                  # Зависимости
├── tsconfig.json                 # TypeScript конфигурация
└── Dockerfile                    # Docker образ

API эндпоинты:
├── POST /api/v1/auth/login           # Вход через email/password (legacy)
├── POST /api/v1/auth/login-ecp       # Вход через ЭЦП
├── POST /api/v1/auth/egov-mobile/init # Инициализация eGov Mobile сессии
├── GET  /api/v1/auth/egov-mobile/status/{sessionId} # Статус eGov Mobile сессии
├── POST /api/v1/auth/egov-mobile/confirm/{sessionId} # Подтверждение из eGov Mobile
├── POST /api/v1/auth/egov-mobile/cancel/{sessionId} # Отмена eGov Mobile сессии
├── POST /api/v1/auth/login-egov-mobile # Завершение входа через eGov Mobile
├── POST /api/v1/auth/refresh         # Обновление токена
├── POST /api/v1/auth/logout          # Выход из системы
├── GET  /api/v1/auth/me              # Информация о пользователе
├── POST /api/v1/auth/verify-signature # Проверка ЭЦП
└── GET  /api/v1/health               # Проверка здоровья

Особенности реализации:
├── Множественные методы аутентификации:
│   ├── ЭЦП через NCALayer (приоритетный)
│   ├── eGov Mobile с QR кодами и deeplinks
│   └── Email/password (legacy, для совместимости)
├── JWT токены с TTL 15 минут для безопасности
├── Refresh токены с TTL 7 дней
├── Redis сессии для мгновенного отзыва доступа
├── eGov Mobile session management с TTL 5 минут
├── Certificate validation для ЭЦП
├── Rate limiting против брутфорса (5 попыток в минуту)
├── Валидация всех входных данных через Zod
├── Structured логирование всех действий
└── Graceful shutdown при получении SIGTERM/SIGINT

──────────────────────────────────────────────────────────────────────────────

2. USER SERVICE (порт 3002) - УПРАВЛЕНИЕ ПОЛЬЗОВАТЕЛЯМИ
──────────────────────────────────────────────────────────────────────────────
Назначение: Управление профилями пользователей, контактами и поиском

Технологии:
├── Node.js 18 + TypeScript 5.5
├── Express.js 4.18 (HTTP сервер)
├── Drizzle ORM для работы с PostgreSQL
├── ElasticSearch для поиска пользователей
├── Redis для кэширования профилей
├── Axios для межсервисных запросов
└── Winston для логирования

Структура кода:
user-service/
├── src/
│   ├── config/
│   │   └── index.ts              # Конфигурация
│   ├── controllers/
│   │   └── user.controller.ts    # HTTP контроллеры
│   ├── services/
│   │   ├── user.service.ts       # Основная бизнес-логика
│   │   ├── cache.service.ts      # Кэширование в Redis
│   │   ├── search.service.ts     # Поиск через ElasticSearch
│   │   └── contact.service.ts    # Управление контактами
│   ├── middleware/
│   │   ├── auth.middleware.ts    # Проверка аутентификации
│   │   └── validation.middleware.ts # Валидация данных
│   ├── routes/
│   │   ├── user.routes.ts        # Маршруты пользователей
│   │   └── index.ts              # Сборка маршрутов
│   ├── utils/
│   │   └── logger.ts             # Логирование
│   ├── app.ts                    # Express приложение
│   └── index.ts                  # Точка входа
├── package.json
├── tsconfig.json
└── Dockerfile

API эндпоинты:
├── GET  /api/v1/users/profile        # Профиль пользователя
├── PUT  /api/v1/users/profile        # Обновление профиля
├── GET  /api/v1/users/search         # Поиск пользователей
├── POST /api/v1/users/contacts       # Добавить в контакты
├── GET  /api/v1/users/contacts/list  # Список контактов
├── DELETE /api/v1/users/contacts/{id} # Удалить контакт
├── GET  /api/v1/users/{id}           # Получить пользователя по ID
└── GET  /api/v1/health               # Проверка здоровья

База данных (PostgreSQL таблицы):
├── users                 # Основная таблица пользователей
│   ├── id (UUID)         # Уникальный идентификатор
│   ├── email (VARCHAR)   # Email адрес
│   ├── full_name (VARCHAR) # Полное имя
│   ├── position (VARCHAR)  # Должность
│   ├── department (VARCHAR) # Отдел
│   ├── avatar (VARCHAR)    # URL аватара
│   ├── role (ENUM)        # Роль: admin, moderator, user
│   ├── status (ENUM)      # Статус: active, inactive, blocked
│   ├── digital_signature (TEXT) # ЭЦП
│   ├── created_at (TIMESTAMP) # Дата создания
│   └── updated_at (TIMESTAMP) # Дата обновления
└── user_contacts         # Контакты пользователей
    ├── id (UUID)         # Уникальный идентификатор
    ├── user_id (UUID)    # ID пользователя
    ├── contact_id (UUID) # ID контакта
    ├── nickname (VARCHAR) # Псевдоним контакта
    ├── is_favorite (BOOLEAN) # Избранный контакт
    ├── created_at (TIMESTAMP) # Дата добавления
    └── updated_at (TIMESTAMP) # Дата обновления

Кэширование в Redis:
├── user:profile:{userId}     # Кэш профиля пользователя (TTL: 1 час)
├── user:contacts:{userId}    # Кэш списка контактов (TTL: 30 мин)
├── user:search:{query}       # Кэш результатов поиска (TTL: 15 мин)
└── user:permissions:{userId} # Кэш прав доступа (TTL: 1 час)

ElasticSearch индексы:
└── users_index
    ├── full_name (text, analyzer: russian)    # Полное имя
    ├── email (keyword)                        # Email
    ├── position (text, analyzer: russian)     # Должность
    ├── department (text, analyzer: russian)   # Отдел
    ├── status (keyword)                       # Статус
    └── created_at (date)                      # Дата создания

──────────────────────────────────────────────────────────────────────────────

3. CHAT SERVICE (порт 3003) - ЧАТЫ И СООБЩЕНИЯ
──────────────────────────────────────────────────────────────────────────────
Назначение: Real-time чаты, сообщения, WebSocket соединения

Технологии:
├── Node.js 18 + TypeScript 5.5
├── Express.js 4.18 (HTTP сервер)
├── Socket.IO 4.7 (WebSocket)
├── Drizzle ORM для PostgreSQL
├── Redis для кэширования и pub/sub
├── Crypto для E2E шифрования (AES-256-GCM)
├── RabbitMQ для очередей сообщений
└── Winston для логирования

Структура кода:
chat-service/
├── src/
│   ├── config/
│   │   └── index.ts              # Конфигурация
│   ├── controllers/
│   │   └── chat.controller.ts    # HTTP контроллеры
│   ├── services/
│   │   ├── chat.service.ts       # Основная логика чатов
│   │   ├── message.service.ts    # Управление сообщениями
│   │   └── cache.service.ts      # Кэширование
│   ├── websocket/
│   │   └── socket.handler.ts     # WebSocket обработчики
│   ├── middleware/
│   │   ├── auth.middleware.ts    # Аутентификация
│   │   └── validation.middleware.ts # Валидация
│   ├── routes/
│   │   ├── chat.routes.ts        # HTTP маршруты
│   │   └── index.ts              # Сборка маршрутов
│   ├── utils/
│   │   ├── encryption.ts         # E2E шифрование
│   │   └── logger.ts             # Логирование
│   ├── app.ts                    # Express + Socket.IO
│   └── index.ts                  # Точка входа
├── package.json
├── tsconfig.json
└── Dockerfile

API эндпоинты:
├── POST /api/v1/chats                # Создать чат
├── GET  /api/v1/chats/user           # Чаты пользователя
├── GET  /api/v1/chats/{id}           # Получить чат
├── PUT  /api/v1/chats/{id}           # Обновить чат
├── DELETE /api/v1/chats/{id}         # Удалить чат
├── POST /api/v1/chats/messages       # Отправить сообщение
├── GET  /api/v1/chats/{id}/messages  # История сообщений
├── PUT  /api/v1/chats/messages/{id}  # Обновить сообщение
├── DELETE /api/v1/chats/messages/{id} # Удалить сообщение
└── GET  /api/v1/health               # Проверка здоровья

WebSocket события:
├── Клиентские события:
│   ├── join_chat           # Присоединиться к чату
│   ├── leave_chat          # Покинуть чат
│   ├── send_message        # Отправить сообщение
│   ├── typing_start        # Начать печатать
│   ├── typing_stop         # Закончить печатать
│   ├── message_read        # Прочитать сообщение
│   └── message_delivered   # Доставить сообщение
└── Серверные события:
    ├── message:new         # Новое сообщение
    ├── message:updated     # Сообщение обновлено
    ├── message:deleted     # Сообщение удалено
    ├── user:typing         # Пользователь печатает
    ├── user:stopped_typing # Пользователь перестал печатать
    ├── chat:updated        # Чат обновлен
    └── user:online_status  # Статус онлайн

База данных (PostgreSQL таблицы):
├── chats                    # Чаты
│   ├── id (UUID)            # Уникальный идентификатор
│   ├── name (VARCHAR)       # Название чата
│   ├── type (ENUM)          # Тип: direct, group, channel
│   ├── is_private (BOOLEAN) # Приватный чат
│   ├── description (TEXT)   # Описание
│   ├── avatar (VARCHAR)     # Аватар чата
│   ├── created_by (UUID)    # Создатель
│   ├── last_message_id (UUID) # Последнее сообщение
│   ├── last_message_at (TIMESTAMP) # Время последнего сообщения
│   ├── created_at (TIMESTAMP) # Дата создания
│   └── updated_at (TIMESTAMP) # Дата обновления
├── chat_participants        # Участники чатов
│   ├── id (UUID)            # Уникальный идентификатор
│   ├── chat_id (UUID)       # ID чата
│   ├── user_id (UUID)       # ID пользователя
│   ├── role (ENUM)          # Роль: admin, moderator, member
│   ├── joined_at (TIMESTAMP) # Дата присоединения
│   ├── last_read_at (TIMESTAMP) # Последнее время чтения
│   └── notification_settings (JSONB) # Настройки уведомлений
└── messages                 # Сообщения
    ├── id (UUID)            # Уникальный идентификатор
    ├── chat_id (UUID)       # ID чата
    ├── sender_id (UUID)     # ID отправителя
    ├── reply_to_id (UUID)   # Ответ на сообщение
    ├── content (TEXT)       # Содержимое сообщения
    ├── encrypted_content (TEXT) # Зашифрованное содержимое
    ├── type (ENUM)          # Тип: text, file, image, video, audio
    ├── file_id (UUID)       # ID файла (если есть)
    ├── metadata (JSONB)     # Метаданные сообщения
    ├── status (ENUM)        # Статус: sent, delivered, read
    ├── is_edited (BOOLEAN)  # Отредактировано
    ├── is_deleted (BOOLEAN) # Удалено
    ├── created_at (TIMESTAMP) # Дата создания
    └── updated_at (TIMESTAMP) # Дата обновления

E2E Шифрование:
├── Алгоритм: AES-256-GCM
├── Ключ генерируется для каждого чата
├── Шифруется на клиенте перед отправкой
├── Расшифровывается на клиенте после получения
├── Сервер хранит только зашифрованные данные
└── Ключи передаются через защищенный канал

Redis кэширование:
├── chat:members:{chatId}     # Участники чата (TTL: 30 мин)
├── chat:info:{chatId}        # Информация о чате (TTL: 1 час)
├── user:chats:{userId}       # Чаты пользователя (TTL: 15 мин)
├── message:cache:{messageId} # Кэш сообщений (TTL: 5 мин)
└── typing:{chatId}           # Состояние печати (TTL: 10 сек)

──────────────────────────────────────────────────────────────────────────────

4. FILE SERVICE (порт 3004) - УПРАВЛЕНИЕ ФАЙЛАМИ
──────────────────────────────────────────────────────────────────────────────
Назначение: Загрузка, хранение, обработка и доставка файлов

Технологии:
├── Node.js 18 + TypeScript 5.5
├── Express.js 4.18 (HTTP сервер)
├── Multer для загрузки файлов
├── Sharp для обработки изображений
├── FFmpeg для обработки видео
├── AWS SDK для работы с S3 (MinIO)
├── Drizzle ORM для PostgreSQL
├── Redis для кэширования метаданных
├── Crypto для шифрования файлов
└── Winston для логирования

Структура кода:
file-service/
├── src/
│   ├── config/
│   │   └── index.ts              # Конфигурация
│   ├── controllers/
│   │   └── file.controller.ts    # HTTP контроллеры
│   ├── services/
│   │   ├── file.service.ts       # Основная логика файлов
│   │   ├── storage.service.ts    # Работа с S3/MinIO
│   │   ├── processing.service.ts # Обработка файлов
│   │   └── cache.service.ts      # Кэширование
│   ├── middleware/
│   │   ├── auth.middleware.ts    # Аутентификация
│   │   └── validation.middleware.ts # Валидация
│   ├── routes/
│   │   ├── file.routes.ts        # Маршруты файлов
│   │   └── index.ts              # Сборка маршрутов
│   ├── utils/
│   │   └── logger.ts             # Логирование
│   ├── app.ts                    # Express приложение
│   └── index.ts                  # Точка входа
├── package.json
├── tsconfig.json
└── Dockerfile

API эндпоинты:
├── POST /api/v1/files/upload         # Загрузить файл
├── POST /api/v1/files/upload-multiple # Множественная загрузка
├── GET  /api/v1/files/user           # Файлы пользователя
├── GET  /api/v1/files/{id}           # Информация о файле
├── GET  /api/v1/files/{id}/download  # Скачать файл
├── GET  /api/v1/files/{id}/preview   # Предпросмотр файла
├── POST /api/v1/files/{id}/url       # Временная ссылка на файл
├── DELETE /api/v1/files/{id}         # Удалить файл
└── GET  /api/v1/health               # Проверка здоровья

База данных (PostgreSQL таблицы):
├── files                    # Файлы
│   ├── id (UUID)            # Уникальный идентификатор
│   ├── filename (VARCHAR)   # Имя файла в хранилище
│   ├── original_name (VARCHAR) # Оригинальное имя файла
│   ├── mime_type (VARCHAR)  # MIME тип файла
│   ├── size (INTEGER)       # Размер файла в байтах
│   ├── type (ENUM)          # Тип: image, video, audio, document, archive, other
│   ├── url (VARCHAR)        # URL файла
│   ├── thumbnail_url (VARCHAR) # URL превью
│   ├── preview_url (VARCHAR) # URL предпросмотра
│   ├── uploaded_by (UUID)   # ID загрузившего пользователя
│   ├── is_public (BOOLEAN)  # Публичный файл
│   ├── is_encrypted (BOOLEAN) # Зашифрован
│   ├── checksum (VARCHAR)   # Контрольная сумма (SHA-256)
│   ├── tags (JSONB)         # Теги файла
│   ├── description (TEXT)   # Описание файла
│   ├── virus_scan_status (ENUM) # Статус проверки на вирусы
│   ├── metadata (JSONB)     # Метаданные файла
│   ├── created_at (TIMESTAMP) # Дата загрузки
│   └── updated_at (TIMESTAMP) # Дата обновления
└── file_permissions         # Права доступа к файлам
    ├── id (UUID)            # Уникальный идентификатор
    ├── file_id (UUID)       # ID файла
    ├── user_id (UUID)       # ID пользователя
    ├── permission (ENUM)    # Право: read, write, delete
    ├── granted_by (UUID)    # Кто предоставил доступ
    ├── created_at (TIMESTAMP) # Дата предоставления
    └── expires_at (TIMESTAMP) # Дата истечения (опционально)

S3/MinIO структура хранения:
gov-platform-files/
├── uploads/                 # Основные файлы
│   ├── {userId}/            # Группировка по пользователям
│   │   ├── {timestamp}-{random}-{filename}
│   │   └── ...
│   └── ...
├── thumbnails/              # Превью изображений
│   ├── small_              # Размер 150x150
│   ├── medium_             # Размер 300x300
│   └── large_              # Размер 800x600
├── previews/                # Предпросмотры документов
│   ├── pdf_preview_        # Превью PDF документов
│   ├── doc_preview_        # Превью Word документов
│   └── video_thumb_        # Кадры из видео
├── avatars/                 # Аватары пользователей
└── temp/                    # Временные файлы (автоочистка)

Возможности обработки файлов:
├── Изображения (Sharp):
│   ├── Автогенерация превью (3 размера)
│   ├── Оптимизация качества и размера
│   ├── Конвертация форматов (WebP, JPEG, PNG)
│   ├── Получение метаданных (разрешение, EXIF)
│   └── Watermark (будущая функция)
├── Видео (FFmpeg):
│   ├── Извлечение кадра для превью
│   ├── Получение метаданных (длительность, разрешение)
│   ├── Сжатие видео (будущая функция)
│   └── Генерация preview клипов
├── Документы:
│   ├── PDF превью первых страниц
│   ├── Word документы в изображения
│   ├── Извлечение текста для индексации
│   └── Получение метаданных
└── Аудио:
    ├── Извлечение метаданных
    ├── Генерация waveform (будущая функция)
    └── Сжатие аудио

Безопасность файлов:
├── Шифрование в хранилище (AES-256-GCM)
├── Проверка MIME типов при загрузке
├── Валидация размеров файлов (макс. 100MB)
├── Антивирусная проверка (готовность к подключению)
├── Контрольные суммы для проверки целостности
├── Подписанные URL с истечением срока действия
├── Права доступа на уровне файлов
└── Аудит всех операций с файлами

Redis кэширование:
├── file:info:{fileId}        # Метаданные файла (TTL: 1 час)
├── file:url:{fileId}         # Временные URL (TTL: время действия)
├── file:processing:{fileId}  # Статус обработки (TTL: 1 час)
├── user:files:{userId}       # Список файлов пользователя (TTL: 30 мин)
└── file:permissions:{fileId} # Права доступа (TTL: 30 мин)

──────────────────────────────────────────────────────────────────────────────

5. API GATEWAY (порт 8080) - ЕДИНАЯ ТОЧКА ВХОДА
──────────────────────────────────────────────────────────────────────────────
Назначение: Маршрутизация, балансировка, мониторинг микросервисов

Технологии:
├── Node.js 18 + TypeScript 5.5
├── Express.js 4.18 (HTTP сервер)
├── http-proxy-middleware для проксирования
├── express-rate-limit для ограничения запросов
├── helmet для безопасности
├── cors для CORS политики
├── compression для сжатия ответов
├── response-time для метрик
└── Winston для логирования

Структура кода:
api-gateway/
├── src/
│   ├── config/
│   │   └── services.ts           # Конфигурация сервисов
│   ├── middleware/
│   │   └── proxy.middleware.ts   # Проксирование запросов
│   ├── utils/
│   │   ├── health-checker.ts     # Проверка здоровья сервисов
│   │   └── logger.ts             # Логирование
│   ├── app.ts                    # Express приложение
│   └── index.ts                  # Точка входа
├── package.json
├── tsconfig.json
└── Dockerfile

Конфигурация сервисов:
├── auth-service:
│   ├── URL: http://auth-service:3001
│   ├── Prefix: /auth
│   ├── Timeout: 5 секунд
│   └── Retries: 3
├── user-service:
│   ├── URL: http://user-service:3002
│   ├── Prefix: /users
│   ├── Timeout: 5 секунд
│   └── Retries: 3
├── chat-service:
│   ├── URL: http://chat-service:3003
│   ├── Prefix: /chats
│   ├── Timeout: 10 секунд (WebSocket)
│   └── Retries: 2
└── file-service:
    ├── URL: http://file-service:3004
    ├── Prefix: /files
    ├── Timeout: 30 секунд (файлы)
    └── Retries: 2

Маршрутизация запросов:
├── /api/v1/auth/*    → auth-service:3001/api/v1/*
├── /api/v1/users/*   → user-service:3002/api/v1/*
├── /api/v1/chats/*   → chat-service:3003/api/v1/*
├── /api/v1/files/*   → file-service:3004/api/v1/*
├── /socket.io/*      → chat-service:3003/socket.io/*
├── /health           → health check всех сервисов
├── /api/discovery    → список доступных сервисов
└── /api/docs         → API документация

Функции Gateway:
├── Проксирование HTTP запросов
├── Проксирование WebSocket соединений
├── Rate limiting (1000 запросов за 15 минут на IP)
├── Health monitoring всех сервисов
├── Circuit breaker при недоступности сервиса
├── Load balancing между экземплярами
├── CORS настройка для фронтенда
├── Компрессия ответов (gzip)
├── Логирование всех запросов
├── Metrics сбор (время ответа, коды статусов)
├── Автоматический retry при ошибках
└── Graceful shutdown

Health Check логика:
├── Проверка каждые 30 секунд
├── Timeout 5 секунд на сервис
├── Circuit breaker после 5 неудач подряд
├── Автовосстановление через 3 успешные проверки
├── Исключение недоступных сервисов из маршрутизации
└── Детальная информация о состоянии каждого сервиса

Rate Limiting:
├── Глобальный лимит: 1000 запросов/15 минут на IP
├── Login лимит: 5 попыток/минуту
├── Upload лимит: 10 загрузок/минуту
├── WebSocket connections: 100 соединений на пользователя
├── Whitelist для доверенных IP
└── Blacklist для заблокированных IP

==============================================================================
                          ИНФРАСТРУКТУРНЫЕ КОМПОНЕНТЫ
==============================================================================

1. POSTGRESQL (порт 5432) - ОСНОВНАЯ БАЗА ДАННЫХ
──────────────────────────────────────────────────────────────────────────────
Версия: PostgreSQL 15 Alpine
Назначение: Хранение основных данных системы

Конфигурация:
├── База данных: gov_platform
├── Пользователь: postgres
├── Пароль: password (в .env)
├── Кодировка: UTF-8
├── Локаль: ru_RU.UTF-8
└── Timezone: Europe/Moscow

Структура базы данных:
├── Схема public (основная)
├── 12 основных таблиц
├── Индексы для производительности
├── Foreign Key constraints для целостности
├── Check constraints для валидации
├── Triggers для автообновления timestamps
└── Views для сложных запросов

Основные таблицы:
├── users (пользователи)
├── user_contacts (контакты пользователей)
├── chats (чаты и каналы)
├── chat_participants (участники чатов)
├── messages (сообщения)
├── files (файлы и медиа)
├── file_permissions (права доступа к файлам)
├── channels (публичные каналы)
├── groups (рабочие группы)
├── bots (боты и автоматизация)
├── calls (звонки и видеозвонки)
└── notifications (уведомления)

Индексы для производительности:
├── users:
│   ├── idx_users_email (уникальный)
│   ├── idx_users_status
│   └── idx_users_department
├── messages:
│   ├── idx_messages_chat_id
│   ├── idx_messages_sender_id
│   ├── idx_messages_created_at
│   └── idx_messages_composite (chat_id, created_at)
├── files:
│   ├── idx_files_uploaded_by
│   ├── idx_files_type
│   ├── idx_files_checksum
│   └── idx_files_created_at
└── chat_participants:
    ├── idx_chat_participants_chat_id
    ├── idx_chat_participants_user_id
    └── idx_chat_participants_composite (chat_id, user_id)

Drizzle ORM миграции:
├── Автоматическое применение при старте сервисов
├── Версионирование схемы
├── Rollback возможности
├── Seed данные для разработки
└── Validation схемы при изменениях

Backup стратегия:
├── Ежедневный pg_dump в 2:00 AM
├── Retention: 30 дней
├── Point-in-time recovery через WAL
├── Репликация на standby сервер (продакшен)
└── Мониторинг размера БД и производительности

──────────────────────────────────────────────────────────────────────────────

2. REDIS (порт 6379) - КЭШ И СЕССИИ
──────────────────────────────────────────────────────────────────────────────
Версия: Redis 7 Alpine
Назначение: Кэширование, сессии, pub/sub для real-time

Конфигурация:
├── Пароль: redispassword
├── Max memory: 256MB
├── Eviction policy: allkeys-lru
├── Persistence: RDB + AOF
├── Save intervals: 900 1, 300 10, 60 10000
└── Append only: yes

Использование по сервисам:
├── Auth Service:
│   ├── auth:sessions:{userId}      # Активные сессии
│   ├── auth:refresh:{token}        # Refresh токены
│   ├── auth:blacklist:{token}      # Отозванные токены
│   └── rate_limit:login:{ip}       # Rate limiting логина
├── User Service:
│   ├── user:profile:{userId}       # Кэш профилей
│   ├── user:contacts:{userId}      # Кэш контактов
│   ├── user:search:{query}         # Результаты поиска
│   └── user:permissions:{userId}   # Права доступа
├── Chat Service:
│   ├── chat:members:{chatId}       # Участники чата
│   ├── chat:info:{chatId}          # Информация о чате
│   ├── user:chats:{userId}         # Чаты пользователя
│   ├── message:cache:{messageId}   # Кэш сообщений
│   ├── typing:{chatId}             # Состояние печати
│   └── online:users                # Онлайн пользователи
├── File Service:
│   ├── file:info:{fileId}          # Метаданные файлов
│   ├── file:url:{fileId}           # Временные URL
│   ├── file:processing:{fileId}    # Статус обработки
│   └── user:files:{userId}         # Файлы пользователя
└── API Gateway:
    ├── rate_limit:{ip}             # Rate limiting
    ├── health:{service}            # Health status
    └── circuit_breaker:{service}   # Circuit breaker state

Pub/Sub каналы:
├── chat:message:{chatId}           # Новые сообщения в чате
├── user:status:{userId}            # Статус пользователя онлайн/оффлайн
├── notification:{userId}           # Уведомления пользователю
├── system:broadcast                # Системные уведомления
└── admin:events                    # Административные события

TTL стратегия:
├── Сессии: 24 часа
├── Профили пользователей: 1 час
├── Результаты поиска: 15 минут
├── Временные URL файлов: время действия URL
├── Состояние печати: 10 секунд
├── Rate limit счетчики: время окна
└── Health status: 1 минута

Мониторинг:
├── Memory usage
├── Connected clients
├── Commands per second
├── Hit rate кэша
├── Slow query log
└── Replication lag (если есть)

──────────────────────────────────────────────────────────────────────────────

3. ELASTICSEARCH (порт 9200) - ПОИСК
──────────────────────────────────────────────────────────────────────────────
Версия: Elasticsearch 8.8 
Назначение: Полнотекстовый поиск пользователей и сообщений

Конфигурация:
├── Cluster name: gov-platform-search
├── Node name: node-1
├── Memory: 1GB heap
├── Discovery type: single-node
├── Security: отключена для разработки
└── Network host: 0.0.0.0

Индексы:
├── users_index (пользователи):
│   ├── full_name (text, analyzer: russian)
│   ├── email (keyword)
│   ├── position (text, analyzer: russian)
│   ├── department (text, analyzer: russian)
│   ├── status (keyword)
│   ├── role (keyword)
│   └── created_at (date)
├── messages_index (сообщения, будущее):
│   ├── content (text, analyzer: russian)
│   ├── chat_id (keyword)
│   ├── sender_id (keyword)
│   ├── type (keyword)
│   └── created_at (date)
└── files_index (файлы, будущее):
    ├── original_name (text, analyzer: russian)
    ├── description (text, analyzer: russian)
    ├── type (keyword)
    ├── tags (keyword)
    └── uploaded_by (keyword)

Анализаторы:
├── russian (встроенный):
│   ├── Tokenizer: standard
│   ├── Filters: lowercase, russian_stop, russian_stemmer
│   └── Character filters: html_strip
└── autocomplete (кастомный):
    ├── Tokenizer: edge_ngram
    ├── Min_gram: 2
    ├── Max_gram: 20
    └── Filters: lowercase

Mapping настройки:
├── Dynamic mapping: false (строгий контроль схемы)
├── Включение _source для всех полей
├── Fielddata отключена для text полей
├── Doc values включены для aggregations
└── Refresh interval: 5 секунд

Поисковые возможности:
├── Автодополнение по имени пользователя
├── Поиск по должности и отделу
├── Fuzzy поиск с исправлением опечаток
├── Фильтрация по статусу и роли
├── Сортировка по релевантности
├── Пагинация результатов
├── Подсветка найденных терминов
└── Агрегации по отделам и должностям

Синхронизация с PostgreSQL:
├── Обновление индекса при изменении пользователя
├── Batch синхронизация каждые 5 минут
├── Webhook для real-time обновлений
├── Retry механизм при ошибках
└── Conflict resolution при concurrent updates

Мониторинг:
├── Cluster health (green/yellow/red)
├── Index size и document count
├── Query performance
├── Memory usage
├── Disk usage
└── Failed queries

──────────────────────────────────────────────────────────────────────────────

4. MINIO (порт 9000, UI 9001) - S3-СОВМЕСТИМОЕ ХРАНИЛИЩЕ
──────────────────────────────────────────────────────────────────────────────
Версия: MinIO RELEASE.2023-07-07T07-13-57Z
Назначение: Объектное хранилище файлов

Конфигурация:
├── Access Key: minioadmin
├── Secret Key: minioadmin123
├── Console: http://localhost:9001
├── API: http://localhost:9000
├── Region: us-east-1
└── Signature version: v4

Bucket структура:
gov-platform-files/
├── uploads/
│   ├── {userId}/                   # Файлы по пользователям
│   │   ├── documents/              # Документы
│   │   ├── images/                 # Изображения
│   │   ├── videos/                 # Видео файлы
│   │   ├── audio/                  # Аудио файлы
│   │   └── archives/               # Архивы
│   └── shared/                     # Общие файлы
├── thumbnails/
│   ├── small/                      # 150x150
│   ├── medium/                     # 300x300
│   └── large/                      # 800x600
├── previews/
│   ├── documents/                  # PDF, Word превью
│   ├── videos/                     # Кадры из видео
│   └── audio/                      # Waveforms
├── avatars/
│   ├── users/                      # Аватары пользователей
│   └── chats/                      # Аватары чатов
├── temp/                           # Временные файлы
│   ├── uploads/                    # Промежуточные загрузки
│   └── processing/                 # Файлы в обработке
└── system/
    ├── backups/                    # Бэкапы системы
    └── logs/                       # Архивы логов

Bucket политики:
├── Публичное чтение для avatars/
├── Приватное для uploads/ (только через signed URLs)
├── Приватное для previews/ (только через API)
├── Админский доступ для system/
└── Автоочистка temp/ через lifecycle policy

Lifecycle правила:
├── Удаление temp/ файлов через 24 часа
├── Transition в IA storage через 30 дней
├── Удаление deleted файлов через 30 дней
├── Сжатие старых логов через 7 дней
└── Архивирование бэкапов через 90 дней

Versioning и backup:
├── Versioning включен для critical buckets
├── Retention: 30 версий или 90 дней
├── Replication на secondary MinIO (продакшен)
├── Ежедневный backup metadata
└── Point-in-time restore возможности

Безопасность:
├── IAM policies для доступа
├── Bucket encryption (AES-256)
├── TLS для всех соединений
├── Access logging всех операций
├── Signed URLs с TTL
└── IP whitelist для admin операций

Мониторинг:
├── Storage usage per bucket
├── Request rate и latency
├── Error rate
├── Bandwidth usage
├── Object count
└── Replication status

──────────────────────────────────────────────────────────────────────────────

5. RABBITMQ (порт 5672, UI 15672) - ОЧЕРЕДИ СООБЩЕНИЙ
──────────────────────────────────────────────────────────────────────────────
Версия: RabbitMQ 3.12 Management Alpine
Назначение: Асинхронная обработка задач и межсервисная коммуникация

Конфигурация:
├── Username: rabbitmq
├── Password: rabbitmq123
├── Management UI: http://localhost:15672
├── AMQP Port: 5672
├── Virtual host: /
└── Heartbeat: 60 секунд

Exchanges (обменники):
├── chat.events (topic):
│   ├── Routing keys:
│   │   ├── message.sent.{chatId}
│   │   ├── message.updated.{chatId}
│   │   ├── user.joined.{chatId}
│   │   ├── user.left.{chatId}
│   │   └── typing.{chatId}.{userId}
│   └── Durability: true
├── file.processing (direct):
│   ├── Routing keys:
│   │   ├── thumbnail.generate
│   │   ├── preview.generate
│   │   ├── virus.scan
│   │   └── metadata.extract
│   └── Durability: true
├── notifications (fanout):
│   ├── Broadcast ко всем подписанным сервисам
│   ├── Push notifications
│   ├── Email notifications
│   └── SMS notifications
└── user.events (topic):
    ├── Routing keys:
    │   ├── profile.updated.{userId}
    │   ├── status.changed.{userId}
    │   ├── contact.added.{userId}
    │   └── permission.changed.{userId}
    └── Durability: true

Queues (очереди):
├── message.processing:
│   ├── Consumer: Chat Service
│   ├── Durability: true
│   ├── Auto-delete: false
│   ├── TTL: 24 часа
│   └── Max priority: 10
├── file.thumbnail:
│   ├── Consumer: File Service
│   ├── Durability: true
│   ├── Concurrent workers: 3
│   ├── Prefetch count: 1
│   └── Retry: 3 попытки
├── email.notifications:
│   ├── Consumer: Notification Service (будущее)
│   ├── Durability: true
│   ├── Rate limiting: 100/минуту
│   ├── Dead letter: email.failed
│   └── TTL: 1 час
├── push.notifications:
│   ├── Consumer: Notification Service (будущее)
│   ├── Durability: true
│   ├── Priority queue: true
│   ├── Batch size: 100
│   └── TTL: 30 минут
└── system.events:
    ├── Consumer: все сервисы
    ├── Durability: true
    ├── Broadcast режим
    ├── TTL: 5 минут
    └── Auto-ack: false

Message patterns:
├── Work Queue (балансировка нагрузки):
│   ├── Файлы → обработка превью
│   ├── Email → отправка уведомлений
│   └── Push → доставка нотификаций
├── Publish/Subscribe (рассылка):
│   ├── Системные события
│   ├── Broadcast уведомления
│   └── Статистика и метрики
├── Routing (условная доставка):
│   ├── События чатов по ID
│   ├── Уведомления по типу
│   └── Пользовательские события
└── RPC (запрос-ответ):
    ├── Межсервисная коммуникация
    ├── Валидация данных
    └── Проверка прав доступа

Dead Letter Queues:
├── file.processing.failed
├── email.notifications.failed
├── push.notifications.failed
└── general.failed

Monitoring:
├── Queue depth
├── Message rate (in/out)
├── Consumer count
├── Memory usage
├── Disk usage
├── Connection count
├── Channel count
└── Error rate

High Availability:
├── Cluster из 3 нод (продакшен)
├── Mirrored queues
├── Automatic failover
├── Load balancing
└── Backup и restore

──────────────────────────────────────────────────────────────────────────────

6. NGINX (порт 80) - LOAD BALANCER И REVERSE PROXY
──────────────────────────────────────────────────────────────────────────────
Версия: Nginx Alpine latest
Назначение: Балансировка нагрузки, SSL termination, статические файлы

Конфигурация:
├── Worker processes: auto
├── Worker connections: 1024
├── Keepalive timeout: 65
├── Client max body size: 100MB
├── Gzip compression: включено
└── Access log: включено

Upstream servers:
├── api_gateway:
│   ├── server api-gateway:8080
│   ├── Keepalive: 32 соединения
│   ├── Health check: /health
│   └── Fail timeout: 30 секунд
├── frontend_servers:
│   ├── server frontend-shell:80
│   ├── Backup server: maintenance page
│   └── Health check: /health
└── file_servers:
    ├── server file-service:3004
    ├── Max fails: 3
    └── Fail timeout: 60 секунд

Location блоки:
├── / (root):
│   ├── Proxy to frontend-shell:80
│   ├── Try files или fallback к index.html
│   ├── Cache static assets (1 год)
│   └── Gzip compression
├── /api/:
│   ├── Proxy to api-gateway:8080
│   ├── Rate limiting: 1000 req/15min
│   ├── Timeout: 60 секунд
│   ├── Headers: X-Real-IP, X-Forwarded-For
│   └── CORS headers
├── /socket.io/:
│   ├── Proxy to api-gateway:8080
│   ├── WebSocket upgrade support
│   ├── Sticky sessions
│   ├── No caching
│   └── Long timeout: 24 часа
├── /files/:
│   ├── Proxy to file-service:3004
│   ├── Large client body size
│   ├── Extended timeout: 300 секунд
│   └── Range requests support
└── /health:
    ├── Health check endpoint
    ├── Internal only
    ├── Response: "healthy"
    └── No logging

Rate limiting:
├── API общий: 1000 запросов/15 минут на IP
├── Login: 5 попыток/минуту на IP
├── File upload: 10 загрузок/минуту на IP
├── WebSocket: 100 соединений на IP
└── Burst handling с delay

Security headers:
├── X-Frame-Options: SAMEORIGIN
├── X-XSS-Protection: 1; mode=block
├── X-Content-Type-Options: nosniff
├── Referrer-Policy: no-referrer-when-downgrade
├── Content-Security-Policy: restrictive
└── Strict-Transport-Security (HTTPS)

Caching:
├── Static assets: 1 год
├── HTML: 1 час
├── API responses: no-cache
├── WebSocket: no-cache
├── File previews: 24 часа
└── Proxy cache: 512MB

SSL/TLS (продакшен):
├── TLS 1.2/1.3 только
├── Strong ciphers только
├── HSTS включен
├── OCSP stapling
├── Certificate transparency
└── Auto-renewal через certbot

Logging:
├── Access log: JSON format
├── Error log: warn level
├── Custom log format с метриками
├── Log rotation: ежедневно
├── Retention: 30 дней
└── Monitoring integration

==============================================================================
                           ОБЩИЕ ПАКЕТЫ И УТИЛИТЫ
==============================================================================

SHARED PACKAGES:
├── @gov-platform/types - TypeScript типы и Zod схемы
├── @gov-platform/database - Drizzle ORM схемы и миграции
├── @gov-platform/config - Общие конфигурации
└── @gov-platform/utils - Общие утилиты

@gov-platform/types:
├── Все интерфейсы данных (User, Chat, Message, File)
├── Enum типы (UserRole, ChatType, MessageType)
├── Zod схемы для валидации
├── API request/response типы
├── Database schema типы
└── Общие utility типы

@gov-platform/database:
├── Drizzle ORM схемы всех таблиц
├── Database connection утилиты
├── Migration скрипты
├── Seed данные
├── Repository базовые классы
└── Database health checks

БЕЗОПАСНОСТЬ:
├── JWT токены с коротким TTL (15 минут)
├── Refresh токены с длинным TTL (7 дней)
├── E2E шифрование чатов (AES-256-GCM)
├── Шифрование файлов в хранилище
├── Rate limiting на всех уровнях
├── Валидация всех входных данных
├── CORS настройки
├── Security headers
├── Audit logging всех действий
└── Regular security updates

МОНИТОРИНГ И ЛОГИРОВАНИЕ:
├── Winston structured logging во всех сервисах
├── Health checks каждые 30 секунд
├── Metrics collection (время ответа, ошибки, throughput)
├── Error tracking и alerting
├── Performance monitoring
├── Resource usage monitoring
├── Business metrics (активные пользователи, сообщения/день)
└── Audit trails для compliance

DEPLOYMENT И CI/CD:
├── Docker контейнеры для всех компонентов
├── Docker Compose для локальной разработки
├── Kubernetes манифесты (готовность)
├── Helm charts (готовность)
├── GitHub Actions workflows (готовность)
├── Automated testing pipeline
├── Blue-green deployment
└── Rollback capabilities

SCALABILITY:
├── Горизонтальное масштабирование всех сервисов
├── Database read replicas
├── Redis clustering
├── MinIO distributed mode
├── RabbitMQ clustering
├── CDN для статических файлов
├── Caching на всех уровнях
└── Auto-scaling based on metrics

==============================================================================
                               ПОРТЫ И ДОСТУП
==============================================================================

ВНЕШНИЕ ПОРТЫ:
├── 3000 - Frontend Shell (React PWA)
├── 8080 - API Gateway (единая точка входа)
├── 80   - Nginx (load balancer)
├── 5432 - PostgreSQL (база данных)
├── 6379 - Redis (кэш и сессии)
├── 9200 - Elasticsearch (поиск)
├── 9000 - MinIO API (файловое хранилище)
├── 9001 - MinIO Console (веб-интерфейс)
├── 5672 - RabbitMQ AMQP (очереди)
└── 15672 - RabbitMQ Management (веб-интерфейс)

ВНУТРЕННИЕ ПОРТЫ:
├── 3001 - Auth Service
├── 3002 - User Service  
├── 3003 - Chat Service
└── 3004 - File Service

ДОСТУП ИЗ ВНЕ:
├── http://localhost:3000 - Основное приложение
├── http://localhost:8080 - API Gateway
├── http://localhost:9001 - MinIO Console (admin: minioadmin/minioadmin123)
├── http://localhost:15672 - RabbitMQ Management (admin: rabbitmq/rabbitmq123)
└── http://localhost:9200 - Elasticsearch (без авторизации)

==============================================================================
                            КОМАНДЫ УПРАВЛЕНИЯ
==============================================================================

ЗАПУСК СИСТЕМЫ:
├── make install          # Установка зависимостей
├── make docker-up        # Запуск всех сервисов
├── make db-setup         # Инициализация БД
├── make health           # Проверка состояния
└── make logs             # Просмотр логов

РАЗРАБОТКА:
├── make dev              # Запуск в режиме разработки
├── make auth-dev         # Только Auth Service
├── make user-dev         # Только User Service
├── make chat-dev         # Только Chat Service
├── make file-dev         # Только File Service
└── make frontend-dev     # Только Frontend

ТЕСТИРОВАНИЕ:
├── make test             # Все тесты
├── make test-unit        # Unit тесты
├── make test-integration # Integration тесты
├── make test-e2e         # E2E тесты
└── make lint             # Проверка кода

MAINTENANCE:
├── make backup           # Backup баз данных
├── make restore          # Restore из backup
├── make clean            # Очистка временных файлов
├── make update           # Обновление зависимостей
└── make docker-clean     # Очистка Docker

==============================================================================
                              ПРОИЗВОДИТЕЛЬНОСТЬ
==============================================================================

ОЖИДАЕМЫЕ ХАРАКТЕРИСТИКИ:
├── Concurrent users: 1000+
├── Messages per second: 100+
├── File uploads: 50 concurrent
├── Database connections: 100 per service
├── Redis connections: 50 per service
├── Response time API: <200ms (p95)
├── WebSocket latency: <50ms
├── File upload time: <30s for 100MB
├── Search response: <100ms
└── Memory usage: ~2GB total

ОПТИМИЗАЦИИ:
├── Connection pooling во всех сервисах
├── Database query optimization с индексами
├── Redis caching с умным TTL
├── File streaming для больших файлов
├── Compression на всех уровнях (gzip, br)
├── CDN ready static assets
├── Database query batching
├── Async processing через RabbitMQ
├── WebSocket connection sharing
└── Graceful degradation при высокой нагрузке

==============================================================================


====================================
3. НОВЫЕ ФУНКЦИИ
====================================

3.1 Иерархия госслужащих
- Добавить модель данных, отражающую структуру госорганов Казахстана (Президент → Министерства → Комитеты → Департаменты → Отделы → Сотрудники).
- Пользователь привязан к своей должности, подразделению и руководителю.
- Роли и права автоматически назначаются на основе должности и положения в иерархии.

3.2 Автоматические каналы
- При добавлении департамента автоматически создаётся закреплённый канал этого департамента.
- В этот канал автоматически добавляются все сотрудники департамента.
- Начальник департамента может публиковать посты, приказы, опросы.

3.3 Система задач
- Руководитель департамента: может назначать задачи всем сотрудникам департамента или выборочно.
- Руководитель отдела: может назначать задачи только своим подчинённым.
- Сотрудники: могут отмечать выполнение задачи или добавлять причину невыполнения.
- У задач есть дедлайн и статус (выполнено/не выполнено).
- Задачи должны отображаться в отдельной вкладке группы и в профиле пользователя.

3.4 Групповые звонки и видеоконференции
- Возможность групповых звонков (аудио и видео) внутри каждой группы.
- Инициировать звонок может только руководитель.
- Возможность демонстрации экрана.
- Подключение через WebRTC, оптимизация под большое количество участников.

3.5 Дисциплинарные меры
- Руководитель департамента: может выдать выговор, благодарность.
- Отображение в профиле сотрудника и в отдельном журнале.

====================================
4. UI/UX ДОРАБОТКИ
====================================
- Левый сайдбар: разделы "Каналы", "Группы", "Личные чаты".
- Внутри группы: вкладки "Чат", "Задачи", "Файлы", "Звонки".
- Закреплённые каналы всегда вверху списка.
- Профиль пользователя: отображение цепочки подчинённых и руководителей.

====================================
5. ТЕХНИЧЕСКИЕ ТРЕБОВАНИЯ
====================================
- Бэкенд: Node.js (добавить новые API-эндпоинты и WebSocket события).
- Фронтенд: React + TypeScript + TailwindCSS (адаптивность обязательна).
- WebRTC сервер (mediasoup или Janus) для звонков.
- PostgreSQL — хранение новых данных (иерархия, задачи, дисциплинарные меры).
- Redis — кэширование и очереди уведомлений.
- Уведомления (push и внутренняя система).

====================================
6. КАЧЕСТВО КОДА
====================================
- Полная типизация (TypeScript).
- Чистая архитектура и разбиение на модули.
- Валидация входных данных на фронтенде и бэкенде.
- Логирование действий пользователей.
- Защита от XSS/CSRF.

====================================
7. ЦЕЛЬ
====================================
Добавить перечисленные функции в уже существующий проект, сохранив весь текущий функционал и внешний вид.
